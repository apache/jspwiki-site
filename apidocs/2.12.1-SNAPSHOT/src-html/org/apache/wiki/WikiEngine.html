<!DOCTYPE HTML>
<html lang="en">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<main role="main">
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span><a id="line.1">/*</a>
<span class="sourceLineNo">002</span><a id="line.2">    Licensed to the Apache Software Foundation (ASF) under one</a>
<span class="sourceLineNo">003</span><a id="line.3">    or more contributor license agreements.  See the NOTICE file</a>
<span class="sourceLineNo">004</span><a id="line.4">    distributed with this work for additional information</a>
<span class="sourceLineNo">005</span><a id="line.5">    regarding copyright ownership.  The ASF licenses this file</a>
<span class="sourceLineNo">006</span><a id="line.6">    to you under the Apache License, Version 2.0 (the</a>
<span class="sourceLineNo">007</span><a id="line.7">    "License"); you may not use this file except in compliance</a>
<span class="sourceLineNo">008</span><a id="line.8">    with the License.  You may obtain a copy of the License at</a>
<span class="sourceLineNo">009</span><a id="line.9"></a>
<span class="sourceLineNo">010</span><a id="line.10">       http://www.apache.org/licenses/LICENSE-2.0</a>
<span class="sourceLineNo">011</span><a id="line.11"></a>
<span class="sourceLineNo">012</span><a id="line.12">    Unless required by applicable law or agreed to in writing,</a>
<span class="sourceLineNo">013</span><a id="line.13">    software distributed under the License is distributed on an</a>
<span class="sourceLineNo">014</span><a id="line.14">    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</a>
<span class="sourceLineNo">015</span><a id="line.15">    KIND, either express or implied.  See the License for the</a>
<span class="sourceLineNo">016</span><a id="line.16">    specific language governing permissions and limitations</a>
<span class="sourceLineNo">017</span><a id="line.17">    under the License.</a>
<span class="sourceLineNo">018</span><a id="line.18"> */</a>
<span class="sourceLineNo">019</span><a id="line.19">package org.apache.wiki;</a>
<span class="sourceLineNo">020</span><a id="line.20"></a>
<span class="sourceLineNo">021</span><a id="line.21">import org.apache.commons.lang3.StringUtils;</a>
<span class="sourceLineNo">022</span><a id="line.22">import org.apache.logging.log4j.LogManager;</a>
<span class="sourceLineNo">023</span><a id="line.23">import org.apache.logging.log4j.Logger;</a>
<span class="sourceLineNo">024</span><a id="line.24">import org.apache.wiki.api.Release;</a>
<span class="sourceLineNo">025</span><a id="line.25">import org.apache.wiki.api.core.Engine;</a>
<span class="sourceLineNo">026</span><a id="line.26">import org.apache.wiki.api.core.Page;</a>
<span class="sourceLineNo">027</span><a id="line.27">import org.apache.wiki.api.engine.Initializable;</a>
<span class="sourceLineNo">028</span><a id="line.28">import org.apache.wiki.api.exceptions.ProviderException;</a>
<span class="sourceLineNo">029</span><a id="line.29">import org.apache.wiki.api.exceptions.WikiException;</a>
<span class="sourceLineNo">030</span><a id="line.30">import org.apache.wiki.attachment.AttachmentManager;</a>
<span class="sourceLineNo">031</span><a id="line.31">import org.apache.wiki.auth.AuthenticationManager;</a>
<span class="sourceLineNo">032</span><a id="line.32">import org.apache.wiki.auth.AuthorizationManager;</a>
<span class="sourceLineNo">033</span><a id="line.33">import org.apache.wiki.auth.UserManager;</a>
<span class="sourceLineNo">034</span><a id="line.34">import org.apache.wiki.auth.acl.AclManager;</a>
<span class="sourceLineNo">035</span><a id="line.35">import org.apache.wiki.auth.authorize.GroupManager;</a>
<span class="sourceLineNo">036</span><a id="line.36">import org.apache.wiki.cache.CachingManager;</a>
<span class="sourceLineNo">037</span><a id="line.37">import org.apache.wiki.content.PageRenamer;</a>
<span class="sourceLineNo">038</span><a id="line.38">import org.apache.wiki.diff.DifferenceManager;</a>
<span class="sourceLineNo">039</span><a id="line.39">import org.apache.wiki.event.WikiEngineEvent;</a>
<span class="sourceLineNo">040</span><a id="line.40">import org.apache.wiki.event.WikiEventListener;</a>
<span class="sourceLineNo">041</span><a id="line.41">import org.apache.wiki.event.WikiEventManager;</a>
<span class="sourceLineNo">042</span><a id="line.42">import org.apache.wiki.event.WikiPageEvent;</a>
<span class="sourceLineNo">043</span><a id="line.43">import org.apache.wiki.filters.FilterManager;</a>
<span class="sourceLineNo">044</span><a id="line.44">import org.apache.wiki.i18n.InternationalizationManager;</a>
<span class="sourceLineNo">045</span><a id="line.45">import org.apache.wiki.pages.PageManager;</a>
<span class="sourceLineNo">046</span><a id="line.46">import org.apache.wiki.plugin.PluginManager;</a>
<span class="sourceLineNo">047</span><a id="line.47">import org.apache.wiki.references.ReferenceManager;</a>
<span class="sourceLineNo">048</span><a id="line.48">import org.apache.wiki.render.RenderingManager;</a>
<span class="sourceLineNo">049</span><a id="line.49">import org.apache.wiki.rss.RSSGenerator;</a>
<span class="sourceLineNo">050</span><a id="line.50">import org.apache.wiki.search.SearchManager;</a>
<span class="sourceLineNo">051</span><a id="line.51">import org.apache.wiki.tasks.TasksManager;</a>
<span class="sourceLineNo">052</span><a id="line.52">import org.apache.wiki.ui.CommandResolver;</a>
<span class="sourceLineNo">053</span><a id="line.53">import org.apache.wiki.ui.EditorManager;</a>
<span class="sourceLineNo">054</span><a id="line.54">import org.apache.wiki.ui.TemplateManager;</a>
<span class="sourceLineNo">055</span><a id="line.55">import org.apache.wiki.ui.admin.AdminBeanManager;</a>
<span class="sourceLineNo">056</span><a id="line.56">import org.apache.wiki.ui.progress.ProgressManager;</a>
<span class="sourceLineNo">057</span><a id="line.57">import org.apache.wiki.url.URLConstructor;</a>
<span class="sourceLineNo">058</span><a id="line.58">import org.apache.wiki.util.ClassUtil;</a>
<span class="sourceLineNo">059</span><a id="line.59">import org.apache.wiki.util.PropertyReader;</a>
<span class="sourceLineNo">060</span><a id="line.60">import org.apache.wiki.util.TextUtil;</a>
<span class="sourceLineNo">061</span><a id="line.61">import org.apache.wiki.variables.VariableManager;</a>
<span class="sourceLineNo">062</span><a id="line.62">import org.apache.wiki.workflow.WorkflowManager;</a>
<span class="sourceLineNo">063</span><a id="line.63"></a>
<span class="sourceLineNo">064</span><a id="line.64">import javax.servlet.ServletConfig;</a>
<span class="sourceLineNo">065</span><a id="line.65">import javax.servlet.ServletContext;</a>
<span class="sourceLineNo">066</span><a id="line.66">import java.io.File;</a>
<span class="sourceLineNo">067</span><a id="line.67">import java.io.UnsupportedEncodingException;</a>
<span class="sourceLineNo">068</span><a id="line.68">import java.net.MalformedURLException;</a>
<span class="sourceLineNo">069</span><a id="line.69">import java.net.URL;</a>
<span class="sourceLineNo">070</span><a id="line.70">import java.net.URLDecoder;</a>
<span class="sourceLineNo">071</span><a id="line.71">import java.net.URLEncoder;</a>
<span class="sourceLineNo">072</span><a id="line.72">import java.nio.charset.Charset;</a>
<span class="sourceLineNo">073</span><a id="line.73">import java.nio.charset.StandardCharsets;</a>
<span class="sourceLineNo">074</span><a id="line.74">import java.util.ArrayList;</a>
<span class="sourceLineNo">075</span><a id="line.75">import java.util.Collection;</a>
<span class="sourceLineNo">076</span><a id="line.76">import java.util.Date;</a>
<span class="sourceLineNo">077</span><a id="line.77">import java.util.Enumeration;</a>
<span class="sourceLineNo">078</span><a id="line.78">import java.util.List;</a>
<span class="sourceLineNo">079</span><a id="line.79">import java.util.Locale;</a>
<span class="sourceLineNo">080</span><a id="line.80">import java.util.Map;</a>
<span class="sourceLineNo">081</span><a id="line.81">import java.util.Properties;</a>
<span class="sourceLineNo">082</span><a id="line.82">import java.util.TimeZone;</a>
<span class="sourceLineNo">083</span><a id="line.83">import java.util.concurrent.ConcurrentHashMap;</a>
<span class="sourceLineNo">084</span><a id="line.84">import java.util.stream.Collectors;</a>
<span class="sourceLineNo">085</span><a id="line.85"></a>
<span class="sourceLineNo">086</span><a id="line.86"></a>
<span class="sourceLineNo">087</span><a id="line.87">/**</a>
<span class="sourceLineNo">088</span><a id="line.88"> *  Main implementation for {@link Engine}.</a>
<span class="sourceLineNo">089</span><a id="line.89"> *</a>
<span class="sourceLineNo">090</span><a id="line.90"> *  &lt;P&gt;</a>
<span class="sourceLineNo">091</span><a id="line.91"> *  Using this class:  Always get yourself an instance from JSP page by using the {@code WikiEngine.getInstance(..)} method.  Never create</a>
<span class="sourceLineNo">092</span><a id="line.92"> *  a new WikiEngine() from scratch, unless you're writing tests.</a>
<span class="sourceLineNo">093</span><a id="line.93"> *</a>
<span class="sourceLineNo">094</span><a id="line.94"> *  &lt;p&gt;</a>
<span class="sourceLineNo">095</span><a id="line.95"> *  {@inheritDoc}</a>
<span class="sourceLineNo">096</span><a id="line.96"> */</a>
<span class="sourceLineNo">097</span><a id="line.97">public class WikiEngine implements Engine {</a>
<span class="sourceLineNo">098</span><a id="line.98"></a>
<span class="sourceLineNo">099</span><a id="line.99">    private static final String ATTR_WIKIENGINE = "org.apache.wiki.WikiEngine";</a>
<span class="sourceLineNo">100</span><a id="line.100">    private static final Logger LOG = LogManager.getLogger( WikiEngine.class );</a>
<span class="sourceLineNo">101</span><a id="line.101"></a>
<span class="sourceLineNo">102</span><a id="line.102">    /** Stores properties. */</a>
<span class="sourceLineNo">103</span><a id="line.103">    private Properties m_properties;</a>
<span class="sourceLineNo">104</span><a id="line.104"></a>
<span class="sourceLineNo">105</span><a id="line.105">    /** Should the user info be saved with the page data as well? */</a>
<span class="sourceLineNo">106</span><a id="line.106">    private boolean m_saveUserInfo = true;</a>
<span class="sourceLineNo">107</span><a id="line.107"></a>
<span class="sourceLineNo">108</span><a id="line.108">    /** If true, uses UTF8 encoding for all data */</a>
<span class="sourceLineNo">109</span><a id="line.109">    private boolean m_useUTF8 = true;</a>
<span class="sourceLineNo">110</span><a id="line.110"></a>
<span class="sourceLineNo">111</span><a id="line.111">    /** Store the file path to the basic URL.  When we're not running as a servlet, it defaults to the user's current directory. */</a>
<span class="sourceLineNo">112</span><a id="line.112">    private String m_rootPath = System.getProperty( "user.dir" );</a>
<span class="sourceLineNo">113</span><a id="line.113"></a>
<span class="sourceLineNo">114</span><a id="line.114">    /** Store the ServletContext that we're in.  This may be null if WikiEngine is not running inside a servlet container (i.e. when testing). */</a>
<span class="sourceLineNo">115</span><a id="line.115">    private ServletContext   m_servletContext;</a>
<span class="sourceLineNo">116</span><a id="line.116"></a>
<span class="sourceLineNo">117</span><a id="line.117">    /** Stores the template path.  This is relative to "templates". */</a>
<span class="sourceLineNo">118</span><a id="line.118">    private String           m_templateDir;</a>
<span class="sourceLineNo">119</span><a id="line.119"></a>
<span class="sourceLineNo">120</span><a id="line.120">    /** The default front page name.  Defaults to "Main". */</a>
<span class="sourceLineNo">121</span><a id="line.121">    private String           m_frontPage;</a>
<span class="sourceLineNo">122</span><a id="line.122"></a>
<span class="sourceLineNo">123</span><a id="line.123">    /** The time when this engine was started. */</a>
<span class="sourceLineNo">124</span><a id="line.124">    private Date             m_startTime;</a>
<span class="sourceLineNo">125</span><a id="line.125"></a>
<span class="sourceLineNo">126</span><a id="line.126">    /** The location where the work directory is. */</a>
<span class="sourceLineNo">127</span><a id="line.127">    private String           m_workDir;</a>
<span class="sourceLineNo">128</span><a id="line.128"></a>
<span class="sourceLineNo">129</span><a id="line.129">    /** Each engine has their own application id. */</a>
<span class="sourceLineNo">130</span><a id="line.130">    private String           m_appid = "";</a>
<span class="sourceLineNo">131</span><a id="line.131"></a>
<span class="sourceLineNo">132</span><a id="line.132">    /** engine is up and running or not */</a>
<span class="sourceLineNo">133</span><a id="line.133">    private boolean          m_isConfigured;</a>
<span class="sourceLineNo">134</span><a id="line.134"></a>
<span class="sourceLineNo">135</span><a id="line.135">    /** Stores wikiengine attributes. */</a>
<span class="sourceLineNo">136</span><a id="line.136">    private final Map&lt; String, Object &gt; m_attributes = new ConcurrentHashMap&lt;&gt;();</a>
<span class="sourceLineNo">137</span><a id="line.137"></a>
<span class="sourceLineNo">138</span><a id="line.138">    /** Stores WikiEngine's associated managers. */</a>
<span class="sourceLineNo">139</span><a id="line.139">    protected final Map&lt; Class&lt; ? &gt;, Object &gt; managers = new ConcurrentHashMap&lt;&gt;();</a>
<span class="sourceLineNo">140</span><a id="line.140"></a>
<span class="sourceLineNo">141</span><a id="line.141">    /**</a>
<span class="sourceLineNo">142</span><a id="line.142">     *  Gets a WikiEngine related to this servlet.  Since this method is only called from JSP pages (and JspInit()) to be specific,</a>
<span class="sourceLineNo">143</span><a id="line.143">     *  we throw a RuntimeException if things don't work.</a>
<span class="sourceLineNo">144</span><a id="line.144">     *</a>
<span class="sourceLineNo">145</span><a id="line.145">     *  @param config The ServletConfig object for this servlet.</a>
<span class="sourceLineNo">146</span><a id="line.146">     *  @return A WikiEngine instance.</a>
<span class="sourceLineNo">147</span><a id="line.147">     *  @throws InternalWikiException in case something fails. This is a RuntimeException, so be prepared for it.</a>
<span class="sourceLineNo">148</span><a id="line.148">     */</a>
<span class="sourceLineNo">149</span><a id="line.149">    public static synchronized WikiEngine getInstance( final ServletConfig config ) throws InternalWikiException {</a>
<span class="sourceLineNo">150</span><a id="line.150">        return getInstance( config.getServletContext(), null );</a>
<span class="sourceLineNo">151</span><a id="line.151">    }</a>
<span class="sourceLineNo">152</span><a id="line.152"></a>
<span class="sourceLineNo">153</span><a id="line.153">    /**</a>
<span class="sourceLineNo">154</span><a id="line.154">     *  Gets a WikiEngine related to the servlet. Works like getInstance(ServletConfig), but does not force the Properties object.</a>
<span class="sourceLineNo">155</span><a id="line.155">     *  This method is just an optional way of initializing a WikiEngine for embedded JSPWiki applications; normally, you</a>
<span class="sourceLineNo">156</span><a id="line.156">     *  should use getInstance(ServletConfig).</a>
<span class="sourceLineNo">157</span><a id="line.157">     *</a>
<span class="sourceLineNo">158</span><a id="line.158">     *  @param config The ServletConfig of the webapp servlet/JSP calling this method.</a>
<span class="sourceLineNo">159</span><a id="line.159">     *  @param props  A set of properties, or null, if we are to load JSPWiki's default jspwiki.properties (this is the usual case).</a>
<span class="sourceLineNo">160</span><a id="line.160">     *</a>
<span class="sourceLineNo">161</span><a id="line.161">     *  @return One well-behaving WikiEngine instance.</a>
<span class="sourceLineNo">162</span><a id="line.162">     */</a>
<span class="sourceLineNo">163</span><a id="line.163">    public static synchronized WikiEngine getInstance( final ServletConfig config, final Properties props ) {</a>
<span class="sourceLineNo">164</span><a id="line.164">        return getInstance( config.getServletContext(), props );</a>
<span class="sourceLineNo">165</span><a id="line.165">    }</a>
<span class="sourceLineNo">166</span><a id="line.166"></a>
<span class="sourceLineNo">167</span><a id="line.167">    /**</a>
<span class="sourceLineNo">168</span><a id="line.168">     *  Gets a WikiEngine related to the servlet. Works just like getInstance( ServletConfig )</a>
<span class="sourceLineNo">169</span><a id="line.169">     *</a>
<span class="sourceLineNo">170</span><a id="line.170">     *  @param context The ServletContext of the webapp servlet/JSP calling this method.</a>
<span class="sourceLineNo">171</span><a id="line.171">     *  @param props  A set of properties, or null, if we are to load JSPWiki's default jspwiki.properties (this is the usual case).</a>
<span class="sourceLineNo">172</span><a id="line.172">     *  @return One fully functional, properly behaving WikiEngine.</a>
<span class="sourceLineNo">173</span><a id="line.173">     *  @throws InternalWikiException If the WikiEngine instantiation fails.</a>
<span class="sourceLineNo">174</span><a id="line.174">     */</a>
<span class="sourceLineNo">175</span><a id="line.175">    public static synchronized WikiEngine getInstance( final ServletContext context, Properties props ) throws InternalWikiException {</a>
<span class="sourceLineNo">176</span><a id="line.176">        WikiEngine engine = ( WikiEngine )context.getAttribute( ATTR_WIKIENGINE );</a>
<span class="sourceLineNo">177</span><a id="line.177">        if( engine == null ) {</a>
<span class="sourceLineNo">178</span><a id="line.178">            final String appid = Integer.toString( context.hashCode() );</a>
<span class="sourceLineNo">179</span><a id="line.179">            context.log( " Assigning new engine to " + appid );</a>
<span class="sourceLineNo">180</span><a id="line.180">            try {</a>
<span class="sourceLineNo">181</span><a id="line.181">                if( props == null ) {</a>
<span class="sourceLineNo">182</span><a id="line.182">                    props = PropertyReader.loadWebAppProps( context );</a>
<span class="sourceLineNo">183</span><a id="line.183">                }</a>
<span class="sourceLineNo">184</span><a id="line.184"></a>
<span class="sourceLineNo">185</span><a id="line.185">                engine = new WikiEngine( context, appid );</a>
<span class="sourceLineNo">186</span><a id="line.186">                try {</a>
<span class="sourceLineNo">187</span><a id="line.187">                    //  Note: May be null, if JSPWiki has been deployed in a WAR file.</a>
<span class="sourceLineNo">188</span><a id="line.188">                    engine.start( props );</a>
<span class="sourceLineNo">189</span><a id="line.189">                    LOG.info( "Root path for this Wiki is: '{}'", engine.getRootPath() );</a>
<span class="sourceLineNo">190</span><a id="line.190">                } catch( final Exception e ) {</a>
<span class="sourceLineNo">191</span><a id="line.191">                    final String msg = Release.APPNAME + ": Unable to load and setup properties from jspwiki.properties. " + e.getMessage();</a>
<span class="sourceLineNo">192</span><a id="line.192">                    context.log( msg );</a>
<span class="sourceLineNo">193</span><a id="line.193">                    LOG.error( msg, e );</a>
<span class="sourceLineNo">194</span><a id="line.194">                    throw new WikiException( msg, e );</a>
<span class="sourceLineNo">195</span><a id="line.195">                }</a>
<span class="sourceLineNo">196</span><a id="line.196">                context.setAttribute( ATTR_WIKIENGINE, engine );</a>
<span class="sourceLineNo">197</span><a id="line.197">            } catch( final Exception e ) {</a>
<span class="sourceLineNo">198</span><a id="line.198">                context.log( "ERROR: Failed to create a Wiki engine: " + e.getMessage() );</a>
<span class="sourceLineNo">199</span><a id="line.199">                LOG.error( "ERROR: Failed to create a Wiki engine, stacktrace follows ", e );</a>
<span class="sourceLineNo">200</span><a id="line.200">                throw new InternalWikiException( "No wiki engine, check logs.", e );</a>
<span class="sourceLineNo">201</span><a id="line.201">            }</a>
<span class="sourceLineNo">202</span><a id="line.202">        }</a>
<span class="sourceLineNo">203</span><a id="line.203">        return engine;</a>
<span class="sourceLineNo">204</span><a id="line.204">    }</a>
<span class="sourceLineNo">205</span><a id="line.205"></a>
<span class="sourceLineNo">206</span><a id="line.206">    /**</a>
<span class="sourceLineNo">207</span><a id="line.207">     *  Instantiate the WikiEngine using a given set of properties. Use this constructor for testing purposes only.</a>
<span class="sourceLineNo">208</span><a id="line.208">     *</a>
<span class="sourceLineNo">209</span><a id="line.209">     *  @param properties A set of properties to use to initialize this WikiEngine.</a>
<span class="sourceLineNo">210</span><a id="line.210">     *  @throws WikiException If the initialization fails.</a>
<span class="sourceLineNo">211</span><a id="line.211">     */</a>
<span class="sourceLineNo">212</span><a id="line.212">    public WikiEngine( final Properties properties ) throws WikiException {</a>
<span class="sourceLineNo">213</span><a id="line.213">        start( properties );</a>
<span class="sourceLineNo">214</span><a id="line.214">    }</a>
<span class="sourceLineNo">215</span><a id="line.215"></a>
<span class="sourceLineNo">216</span><a id="line.216">    /**</a>
<span class="sourceLineNo">217</span><a id="line.217">     *  Instantiate using this method when you're running as a servlet and WikiEngine will figure out where to look for the property file.</a>
<span class="sourceLineNo">218</span><a id="line.218">     *  Do not use this method - use WikiEngine.getInstance() instead.</a>
<span class="sourceLineNo">219</span><a id="line.219">     *</a>
<span class="sourceLineNo">220</span><a id="line.220">     *  @param context A ServletContext.</a>
<span class="sourceLineNo">221</span><a id="line.221">     *  @param appid   An Application ID.  This application is a unique random string which is used to recognize this WikiEngine.</a>
<span class="sourceLineNo">222</span><a id="line.222">     *  @throws WikiException If the WikiEngine construction fails.</a>
<span class="sourceLineNo">223</span><a id="line.223">     */</a>
<span class="sourceLineNo">224</span><a id="line.224">    protected WikiEngine( final ServletContext context, final String appid ) throws WikiException {</a>
<span class="sourceLineNo">225</span><a id="line.225">        m_servletContext = context;</a>
<span class="sourceLineNo">226</span><a id="line.226">        m_appid          = appid;</a>
<span class="sourceLineNo">227</span><a id="line.227"></a>
<span class="sourceLineNo">228</span><a id="line.228">        // Stash the WikiEngine in the servlet context</a>
<span class="sourceLineNo">229</span><a id="line.229">        if ( context != null ) {</a>
<span class="sourceLineNo">230</span><a id="line.230">            context.setAttribute( ATTR_WIKIENGINE,  this );</a>
<span class="sourceLineNo">231</span><a id="line.231">            m_rootPath = context.getRealPath( "/" );</a>
<span class="sourceLineNo">232</span><a id="line.232">        }</a>
<span class="sourceLineNo">233</span><a id="line.233">    }</a>
<span class="sourceLineNo">234</span><a id="line.234"></a>
<span class="sourceLineNo">235</span><a id="line.235">    /**</a>
<span class="sourceLineNo">236</span><a id="line.236">     *  Does all the real initialization.</a>
<span class="sourceLineNo">237</span><a id="line.237">     */</a>
<span class="sourceLineNo">238</span><a id="line.238">    @Override</a>
<span class="sourceLineNo">239</span><a id="line.239">    public void initialize( final Properties props ) throws WikiException {</a>
<span class="sourceLineNo">240</span><a id="line.240">        m_startTime  = new Date();</a>
<span class="sourceLineNo">241</span><a id="line.241">        m_properties = props;</a>
<span class="sourceLineNo">242</span><a id="line.242"></a>
<span class="sourceLineNo">243</span><a id="line.243">        LOG.info( "*******************************************" );</a>
<span class="sourceLineNo">244</span><a id="line.244">        LOG.info( "{} {} starting. Whee!", Release.APPNAME, Release.getVersionString() );</a>
<span class="sourceLineNo">245</span><a id="line.245">        LOG.debug( "Java version: {}", System.getProperty( "java.runtime.version" ) );</a>
<span class="sourceLineNo">246</span><a id="line.246">        LOG.debug( "Java vendor: {}", System.getProperty( "java.vm.vendor" ) );</a>
<span class="sourceLineNo">247</span><a id="line.247">        LOG.debug( "OS: {} {} {}", System.getProperty( "os.name" ), System.getProperty( "os.version" ), System.getProperty( "os.arch" ) );</a>
<span class="sourceLineNo">248</span><a id="line.248">        LOG.debug( "Default server locale: {}", Locale.getDefault() );</a>
<span class="sourceLineNo">249</span><a id="line.249">        LOG.debug( "Default server timezone: {}", TimeZone.getDefault().getDisplayName( true, TimeZone.LONG ) );</a>
<span class="sourceLineNo">250</span><a id="line.250"></a>
<span class="sourceLineNo">251</span><a id="line.251">        if( m_servletContext != null ) {</a>
<span class="sourceLineNo">252</span><a id="line.252">            LOG.info( "Servlet container: {}", m_servletContext.getServerInfo() );</a>
<span class="sourceLineNo">253</span><a id="line.253">            if( m_servletContext.getMajorVersion() &lt; 3 || ( m_servletContext.getMajorVersion() == 3 &amp;&amp; m_servletContext.getMinorVersion() &lt; 1 ) ) {</a>
<span class="sourceLineNo">254</span><a id="line.254">                throw new InternalWikiException( "JSPWiki requires a container which supports at least version 3.1 of Servlet specification" );</a>
<span class="sourceLineNo">255</span><a id="line.255">            }</a>
<span class="sourceLineNo">256</span><a id="line.256">        }</a>
<span class="sourceLineNo">257</span><a id="line.257"></a>
<span class="sourceLineNo">258</span><a id="line.258">        fireEvent( WikiEngineEvent.INITIALIZING ); // begin initialization</a>
<span class="sourceLineNo">259</span><a id="line.259"></a>
<span class="sourceLineNo">260</span><a id="line.260">        LOG.debug( "Configuring WikiEngine..." );</a>
<span class="sourceLineNo">261</span><a id="line.261"></a>
<span class="sourceLineNo">262</span><a id="line.262">        createAndFindWorkingDirectory( props );</a>
<span class="sourceLineNo">263</span><a id="line.263"></a>
<span class="sourceLineNo">264</span><a id="line.264">        m_useUTF8        = StandardCharsets.UTF_8.name().equals( TextUtil.getStringProperty( props, PROP_ENCODING, StandardCharsets.ISO_8859_1.name() ) );</a>
<span class="sourceLineNo">265</span><a id="line.265">        m_saveUserInfo   = TextUtil.getBooleanProperty( props, PROP_STOREUSERNAME, m_saveUserInfo );</a>
<span class="sourceLineNo">266</span><a id="line.266">        m_frontPage      = TextUtil.getStringProperty( props, PROP_FRONTPAGE, "Main" );</a>
<span class="sourceLineNo">267</span><a id="line.267">        m_templateDir    = TextUtil.getStringProperty( props, PROP_TEMPLATEDIR, "default" );</a>
<span class="sourceLineNo">268</span><a id="line.268">        enforceValidTemplateDirectory();</a>
<span class="sourceLineNo">269</span><a id="line.269"></a>
<span class="sourceLineNo">270</span><a id="line.270">        //</a>
<span class="sourceLineNo">271</span><a id="line.271">        //  Initialize the important modules.  Any exception thrown by the managers means that we will not start up.</a>
<span class="sourceLineNo">272</span><a id="line.272">        //</a>
<span class="sourceLineNo">273</span><a id="line.273">        try {</a>
<span class="sourceLineNo">274</span><a id="line.274">            final String aclClassName = m_properties.getProperty( PROP_ACL_MANAGER_IMPL, ClassUtil.getMappedClass( AclManager.class.getName() ).getName() );</a>
<span class="sourceLineNo">275</span><a id="line.275">            final String urlConstructorClassName = TextUtil.getStringProperty( props, PROP_URLCONSTRUCTOR, "DefaultURLConstructor" );</a>
<span class="sourceLineNo">276</span><a id="line.276">            final Class&lt; URLConstructor &gt; urlclass = ClassUtil.findClass( "org.apache.wiki.url", urlConstructorClassName );</a>
<span class="sourceLineNo">277</span><a id="line.277"></a>
<span class="sourceLineNo">278</span><a id="line.278">            initComponent( CommandResolver.class, this, props );</a>
<span class="sourceLineNo">279</span><a id="line.279">            initComponent( urlclass.getName(), URLConstructor.class );</a>
<span class="sourceLineNo">280</span><a id="line.280">            initComponent( CachingManager.class, this, props );</a>
<span class="sourceLineNo">281</span><a id="line.281">            initComponent( PageManager.class, this, props );</a>
<span class="sourceLineNo">282</span><a id="line.282">            initComponent( PluginManager.class, this, props );</a>
<span class="sourceLineNo">283</span><a id="line.283">            initComponent( DifferenceManager.class, this, props );</a>
<span class="sourceLineNo">284</span><a id="line.284">            initComponent( AttachmentManager.class, this, props );</a>
<span class="sourceLineNo">285</span><a id="line.285">            initComponent( VariableManager.class, props );</a>
<span class="sourceLineNo">286</span><a id="line.286">            initComponent( SearchManager.class, this, props );</a>
<span class="sourceLineNo">287</span><a id="line.287">            initComponent( AuthenticationManager.class );</a>
<span class="sourceLineNo">288</span><a id="line.288">            initComponent( AuthorizationManager.class );</a>
<span class="sourceLineNo">289</span><a id="line.289">            initComponent( UserManager.class );</a>
<span class="sourceLineNo">290</span><a id="line.290">            initComponent( GroupManager.class );</a>
<span class="sourceLineNo">291</span><a id="line.291">            initComponent( EditorManager.class, this );</a>
<span class="sourceLineNo">292</span><a id="line.292">            initComponent( ProgressManager.class, this );</a>
<span class="sourceLineNo">293</span><a id="line.293">            initComponent( aclClassName, AclManager.class );</a>
<span class="sourceLineNo">294</span><a id="line.294">            initComponent( WorkflowManager.class );</a>
<span class="sourceLineNo">295</span><a id="line.295">            initComponent( TasksManager.class );</a>
<span class="sourceLineNo">296</span><a id="line.296">            initComponent( InternationalizationManager.class, this );</a>
<span class="sourceLineNo">297</span><a id="line.297">            initComponent( TemplateManager.class, this, props );</a>
<span class="sourceLineNo">298</span><a id="line.298">            initComponent( FilterManager.class, this, props );</a>
<span class="sourceLineNo">299</span><a id="line.299">            initComponent( AdminBeanManager.class, this );</a>
<span class="sourceLineNo">300</span><a id="line.300">            initComponent( PageRenamer.class, this, props );</a>
<span class="sourceLineNo">301</span><a id="line.301"></a>
<span class="sourceLineNo">302</span><a id="line.302">            // RenderingManager depends on FilterManager events.</a>
<span class="sourceLineNo">303</span><a id="line.303">            initComponent( RenderingManager.class );</a>
<span class="sourceLineNo">304</span><a id="line.304"></a>
<span class="sourceLineNo">305</span><a id="line.305">            //  ReferenceManager has the side effect of loading all pages. Therefore, after this point, all page attributes are available.</a>
<span class="sourceLineNo">306</span><a id="line.306">            //  initReferenceManager is indirectly using m_filterManager, so it has to be called after it was initialized.</a>
<span class="sourceLineNo">307</span><a id="line.307">            initReferenceManager();</a>
<span class="sourceLineNo">308</span><a id="line.308"></a>
<span class="sourceLineNo">309</span><a id="line.309">            //  Hook the different manager routines into the system.</a>
<span class="sourceLineNo">310</span><a id="line.310">            getManager( FilterManager.class ).addPageFilter( getManager( ReferenceManager.class ), -1001 );</a>
<span class="sourceLineNo">311</span><a id="line.311">            getManager( FilterManager.class ).addPageFilter( getManager( SearchManager.class ), -1002 );</a>
<span class="sourceLineNo">312</span><a id="line.312">        } catch( final RuntimeException e ) {</a>
<span class="sourceLineNo">313</span><a id="line.313">            // RuntimeExceptions may occur here, even if they shouldn't.</a>
<span class="sourceLineNo">314</span><a id="line.314">            LOG.fatal( "Failed to start managers.", e );</a>
<span class="sourceLineNo">315</span><a id="line.315">            throw new WikiException( "Failed to start managers: " + e.getMessage(), e );</a>
<span class="sourceLineNo">316</span><a id="line.316">        } catch( final ClassNotFoundException e ) {</a>
<span class="sourceLineNo">317</span><a id="line.317">            LOG.fatal( "JSPWiki could not start, URLConstructor was not found: {}", e.getMessage(), e );</a>
<span class="sourceLineNo">318</span><a id="line.318">            throw new WikiException( e.getMessage(), e );</a>
<span class="sourceLineNo">319</span><a id="line.319">        } catch( final InstantiationException e ) {</a>
<span class="sourceLineNo">320</span><a id="line.320">            LOG.fatal( "JSPWiki could not start, URLConstructor could not be instantiated: {}", e.getMessage(), e );</a>
<span class="sourceLineNo">321</span><a id="line.321">            throw new WikiException( e.getMessage(), e );</a>
<span class="sourceLineNo">322</span><a id="line.322">        } catch( final IllegalAccessException e ) {</a>
<span class="sourceLineNo">323</span><a id="line.323">            LOG.fatal( "JSPWiki could not start, URLConstructor cannot be accessed: {}", e.getMessage(), e );</a>
<span class="sourceLineNo">324</span><a id="line.324">            throw new WikiException( e.getMessage(), e );</a>
<span class="sourceLineNo">325</span><a id="line.325">        } catch( final Exception e ) {</a>
<span class="sourceLineNo">326</span><a id="line.326">            // Final catch-all for everything</a>
<span class="sourceLineNo">327</span><a id="line.327">            LOG.fatal( "JSPWiki could not start, due to an unknown exception when starting.", e );</a>
<span class="sourceLineNo">328</span><a id="line.328">            throw new WikiException( "Failed to start. Caused by: " + e.getMessage() + "; please check log files for better information.", e );</a>
<span class="sourceLineNo">329</span><a id="line.329">        }</a>
<span class="sourceLineNo">330</span><a id="line.330"></a>
<span class="sourceLineNo">331</span><a id="line.331">        //  Initialize the good-to-have-but-not-fatal modules.</a>
<span class="sourceLineNo">332</span><a id="line.332">        try {</a>
<span class="sourceLineNo">333</span><a id="line.333">            if( TextUtil.getBooleanProperty( props, RSSGenerator.PROP_GENERATE_RSS,false ) ) {</a>
<span class="sourceLineNo">334</span><a id="line.334">                initComponent( RSSGenerator.class, this, props );</a>
<span class="sourceLineNo">335</span><a id="line.335">            }</a>
<span class="sourceLineNo">336</span><a id="line.336">        } catch( final Exception e ) {</a>
<span class="sourceLineNo">337</span><a id="line.337">            LOG.error( "Unable to start RSS generator - JSPWiki will still work, but there will be no RSS feed.", e );</a>
<span class="sourceLineNo">338</span><a id="line.338">        }</a>
<span class="sourceLineNo">339</span><a id="line.339"></a>
<span class="sourceLineNo">340</span><a id="line.340">        final Map&lt; String, String &gt; extraComponents = ClassUtil.getExtraClassMappings();</a>
<span class="sourceLineNo">341</span><a id="line.341">        initExtraComponents( extraComponents );</a>
<span class="sourceLineNo">342</span><a id="line.342"></a>
<span class="sourceLineNo">343</span><a id="line.343">        fireEvent( WikiEngineEvent.INITIALIZED ); // initialization complete</a>
<span class="sourceLineNo">344</span><a id="line.344"></a>
<span class="sourceLineNo">345</span><a id="line.345">        LOG.info( "WikiEngine configured." );</a>
<span class="sourceLineNo">346</span><a id="line.346">        m_isConfigured = true;</a>
<span class="sourceLineNo">347</span><a id="line.347">    }</a>
<span class="sourceLineNo">348</span><a id="line.348"></a>
<span class="sourceLineNo">349</span><a id="line.349">    void createAndFindWorkingDirectory( final Properties props ) throws WikiException {</a>
<span class="sourceLineNo">350</span><a id="line.350">        m_workDir = TextUtil.getStringProperty( props, PROP_WORKDIR, null );</a>
<span class="sourceLineNo">351</span><a id="line.351"></a>
<span class="sourceLineNo">352</span><a id="line.352">        final File f = new File( m_workDir );</a>
<span class="sourceLineNo">353</span><a id="line.353">        try {</a>
<span class="sourceLineNo">354</span><a id="line.354">            f.mkdirs();</a>
<span class="sourceLineNo">355</span><a id="line.355">        } catch( final SecurityException e ) {</a>
<span class="sourceLineNo">356</span><a id="line.356">            LOG.fatal( "Unable to find or create the working directory: {}", m_workDir, e );</a>
<span class="sourceLineNo">357</span><a id="line.357">            throw new WikiException( "Unable to find or create the working dir: " + m_workDir, e );</a>
<span class="sourceLineNo">358</span><a id="line.358">        }</a>
<span class="sourceLineNo">359</span><a id="line.359"></a>
<span class="sourceLineNo">360</span><a id="line.360">        //  A bunch of sanity checks</a>
<span class="sourceLineNo">361</span><a id="line.361">        checkWorkingDirectory( !f.exists(), "Work directory does not exist: " + m_workDir );</a>
<span class="sourceLineNo">362</span><a id="line.362">        checkWorkingDirectory( !f.canRead(), "No permission to read work directory: " + m_workDir );</a>
<span class="sourceLineNo">363</span><a id="line.363">        checkWorkingDirectory( !f.canWrite(), "No permission to write to work directory: " + m_workDir );</a>
<span class="sourceLineNo">364</span><a id="line.364">        checkWorkingDirectory( !f.isDirectory(), "jspwiki.workDir does not point to a directory: " + m_workDir );</a>
<span class="sourceLineNo">365</span><a id="line.365"></a>
<span class="sourceLineNo">366</span><a id="line.366">        LOG.info( "JSPWiki working directory is '{}'", m_workDir );</a>
<span class="sourceLineNo">367</span><a id="line.367">    }</a>
<span class="sourceLineNo">368</span><a id="line.368"></a>
<span class="sourceLineNo">369</span><a id="line.369">    void checkWorkingDirectory( final boolean condition, final String errMsg ) throws WikiException {</a>
<span class="sourceLineNo">370</span><a id="line.370">        if( condition ) {</a>
<span class="sourceLineNo">371</span><a id="line.371">            throw new WikiException( errMsg );</a>
<span class="sourceLineNo">372</span><a id="line.372">        }</a>
<span class="sourceLineNo">373</span><a id="line.373">    }</a>
<span class="sourceLineNo">374</span><a id="line.374"></a>
<span class="sourceLineNo">375</span><a id="line.375">    void initExtraComponents( final Map&lt; String, String &gt; extraComponents ) {</a>
<span class="sourceLineNo">376</span><a id="line.376">        for( final Map.Entry&lt; String, String &gt; extraComponent : extraComponents.entrySet() ) {</a>
<span class="sourceLineNo">377</span><a id="line.377">            try {</a>
<span class="sourceLineNo">378</span><a id="line.378">                LOG.info( "Registering on WikiEngine {} as {}", extraComponent.getKey(), extraComponent.getValue() );</a>
<span class="sourceLineNo">379</span><a id="line.379">                initComponent( extraComponent.getKey(), Class.forName( extraComponent.getValue() ) );</a>
<span class="sourceLineNo">380</span><a id="line.380">            } catch( final Exception e ) {</a>
<span class="sourceLineNo">381</span><a id="line.381">                LOG.error( "Unable to start {}", extraComponent.getKey(), e );</a>
<span class="sourceLineNo">382</span><a id="line.382">            }</a>
<span class="sourceLineNo">383</span><a id="line.383">        }</a>
<span class="sourceLineNo">384</span><a id="line.384">    }</a>
<span class="sourceLineNo">385</span><a id="line.385"></a>
<span class="sourceLineNo">386</span><a id="line.386">    &lt; T &gt; void initComponent( final Class&lt; T &gt; componentClass, final Object... initArgs ) throws Exception {</a>
<span class="sourceLineNo">387</span><a id="line.387">        initComponent( componentClass.getName(), componentClass, initArgs );</a>
<span class="sourceLineNo">388</span><a id="line.388">    }</a>
<span class="sourceLineNo">389</span><a id="line.389"></a>
<span class="sourceLineNo">390</span><a id="line.390">    &lt; T &gt; void initComponent( final String componentInitClass, final Class&lt; T &gt; componentClass, final Object... initArgs ) throws Exception {</a>
<span class="sourceLineNo">391</span><a id="line.391">        final T component;</a>
<span class="sourceLineNo">392</span><a id="line.392">        if( initArgs == null || initArgs.length == 0 ) {</a>
<span class="sourceLineNo">393</span><a id="line.393">            component = ClassUtil.getMappedObject( componentInitClass );</a>
<span class="sourceLineNo">394</span><a id="line.394">        } else {</a>
<span class="sourceLineNo">395</span><a id="line.395">            component = ClassUtil.getMappedObject( componentInitClass, initArgs );</a>
<span class="sourceLineNo">396</span><a id="line.396">        }</a>
<span class="sourceLineNo">397</span><a id="line.397">        managers.put( componentClass, component );</a>
<span class="sourceLineNo">398</span><a id="line.398">        if( Initializable.class.isAssignableFrom( component.getClass() ) ) {</a>
<span class="sourceLineNo">399</span><a id="line.399">            ( ( Initializable )component ).initialize( this, m_properties );</a>
<span class="sourceLineNo">400</span><a id="line.400">        }</a>
<span class="sourceLineNo">401</span><a id="line.401">    }</a>
<span class="sourceLineNo">402</span><a id="line.402"></a>
<span class="sourceLineNo">403</span><a id="line.403">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">404</span><a id="line.404">    @Override</a>
<span class="sourceLineNo">405</span><a id="line.405">    @SuppressWarnings( "unchecked" )</a>
<span class="sourceLineNo">406</span><a id="line.406">    public &lt; T &gt; T getManager( final Class&lt; T &gt; manager ) {</a>
<span class="sourceLineNo">407</span><a id="line.407">        return ( T )managers.entrySet().stream()</a>
<span class="sourceLineNo">408</span><a id="line.408">                                       .filter( e -&gt; manager.isAssignableFrom( e.getKey() ) )</a>
<span class="sourceLineNo">409</span><a id="line.409">                                       .map( Map.Entry::getValue )</a>
<span class="sourceLineNo">410</span><a id="line.410">                                       .findFirst().orElse( null );</a>
<span class="sourceLineNo">411</span><a id="line.411">    }</a>
<span class="sourceLineNo">412</span><a id="line.412"></a>
<span class="sourceLineNo">413</span><a id="line.413">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">414</span><a id="line.414">    @Override</a>
<span class="sourceLineNo">415</span><a id="line.415">    @SuppressWarnings( "unchecked" )</a>
<span class="sourceLineNo">416</span><a id="line.416">    public &lt; T &gt; List&lt; T &gt; getManagers( final Class&lt; T &gt; manager ) {</a>
<span class="sourceLineNo">417</span><a id="line.417">        return ( List&lt; T &gt; )managers.entrySet().stream()</a>
<span class="sourceLineNo">418</span><a id="line.418">                                               .filter( e -&gt; manager.isAssignableFrom( e.getKey() ) )</a>
<span class="sourceLineNo">419</span><a id="line.419">                                               .map( Map.Entry::getValue )</a>
<span class="sourceLineNo">420</span><a id="line.420">                                               .collect( Collectors.toList() );</a>
<span class="sourceLineNo">421</span><a id="line.421">    }</a>
<span class="sourceLineNo">422</span><a id="line.422"></a>
<span class="sourceLineNo">423</span><a id="line.423">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">424</span><a id="line.424">    @Override</a>
<span class="sourceLineNo">425</span><a id="line.425">    public boolean isConfigured() {</a>
<span class="sourceLineNo">426</span><a id="line.426">        return m_isConfigured;</a>
<span class="sourceLineNo">427</span><a id="line.427">    }</a>
<span class="sourceLineNo">428</span><a id="line.428"></a>
<span class="sourceLineNo">429</span><a id="line.429">    /**</a>
<span class="sourceLineNo">430</span><a id="line.430">     * Checks if the template directory specified in the wiki's properties actually exists. If it doesn't, then {@code m_templateDir} is</a>
<span class="sourceLineNo">431</span><a id="line.431">     * set to {@link #DEFAULT_TEMPLATE_NAME}.</a>
<span class="sourceLineNo">432</span><a id="line.432">     * &lt;p&gt;</a>
<span class="sourceLineNo">433</span><a id="line.433">     * This checks the existence of the &lt;tt&gt;ViewTemplate.jsp&lt;/tt&gt; file, which exists in every template using {@code m_servletContext.getRealPath("/")}.</a>
<span class="sourceLineNo">434</span><a id="line.434">     * &lt;p&gt;</a>
<span class="sourceLineNo">435</span><a id="line.435">     * {@code m_servletContext.getRealPath("/")} can return {@code null} on certain servers/conditions (f.ex, packed wars), an extra check</a>
<span class="sourceLineNo">436</span><a id="line.436">     * against {@code m_servletContext.getResource} is made.</a>
<span class="sourceLineNo">437</span><a id="line.437">     */</a>
<span class="sourceLineNo">438</span><a id="line.438">    void enforceValidTemplateDirectory() {</a>
<span class="sourceLineNo">439</span><a id="line.439">        if( m_servletContext != null ) {</a>
<span class="sourceLineNo">440</span><a id="line.440">            final String viewTemplate = "templates" + File.separator + getTemplateDir() + File.separator + "ViewTemplate.jsp";</a>
<span class="sourceLineNo">441</span><a id="line.441">            boolean exists = new File( m_servletContext.getRealPath( "/" ) + viewTemplate ).exists();</a>
<span class="sourceLineNo">442</span><a id="line.442">            if( !exists ) {</a>
<span class="sourceLineNo">443</span><a id="line.443">                try {</a>
<span class="sourceLineNo">444</span><a id="line.444">                    final URL url = m_servletContext.getResource( viewTemplate );</a>
<span class="sourceLineNo">445</span><a id="line.445">                    exists = url != null &amp;&amp; StringUtils.isNotEmpty( url.getFile() );</a>
<span class="sourceLineNo">446</span><a id="line.446">                } catch( final MalformedURLException e ) {</a>
<span class="sourceLineNo">447</span><a id="line.447">                    LOG.warn( "template not found with viewTemplate {}", viewTemplate );</a>
<span class="sourceLineNo">448</span><a id="line.448">                }</a>
<span class="sourceLineNo">449</span><a id="line.449">            }</a>
<span class="sourceLineNo">450</span><a id="line.450">            if( !exists ) {</a>
<span class="sourceLineNo">451</span><a id="line.451">                LOG.warn( "{} template not found, updating WikiEngine's default template to {}", getTemplateDir(), DEFAULT_TEMPLATE_NAME );</a>
<span class="sourceLineNo">452</span><a id="line.452">                m_templateDir = DEFAULT_TEMPLATE_NAME;</a>
<span class="sourceLineNo">453</span><a id="line.453">            }</a>
<span class="sourceLineNo">454</span><a id="line.454">        }</a>
<span class="sourceLineNo">455</span><a id="line.455">    }</a>
<span class="sourceLineNo">456</span><a id="line.456"></a>
<span class="sourceLineNo">457</span><a id="line.457">    /**</a>
<span class="sourceLineNo">458</span><a id="line.458">     *  Initializes the reference manager. Scans all existing WikiPages for</a>
<span class="sourceLineNo">459</span><a id="line.459">     *  internal links and adds them to the ReferenceManager object.</a>
<span class="sourceLineNo">460</span><a id="line.460">     *</a>
<span class="sourceLineNo">461</span><a id="line.461">     *  @throws WikiException If the reference manager initialization fails.</a>
<span class="sourceLineNo">462</span><a id="line.462">     */</a>
<span class="sourceLineNo">463</span><a id="line.463">    public void initReferenceManager() throws WikiException {</a>
<span class="sourceLineNo">464</span><a id="line.464">        try {</a>
<span class="sourceLineNo">465</span><a id="line.465">            // Build a new manager with default key lists.</a>
<span class="sourceLineNo">466</span><a id="line.466">            if( getManager( ReferenceManager.class ) == null ) {</a>
<span class="sourceLineNo">467</span><a id="line.467">                final ArrayList&lt; Page &gt; pages = new ArrayList&lt;&gt;();</a>
<span class="sourceLineNo">468</span><a id="line.468">                pages.addAll( getManager( PageManager.class ).getAllPages() );</a>
<span class="sourceLineNo">469</span><a id="line.469">                pages.addAll( getManager( AttachmentManager.class ).getAllAttachments() );</a>
<span class="sourceLineNo">470</span><a id="line.470">                final String refMgrClassName = m_properties.getProperty( PROP_REF_MANAGER_IMPL, ClassUtil.getMappedClass( ReferenceManager.class.getName() ).getName() );</a>
<span class="sourceLineNo">471</span><a id="line.471"></a>
<span class="sourceLineNo">472</span><a id="line.472">                initComponent( refMgrClassName, ReferenceManager.class, this );</a>
<span class="sourceLineNo">473</span><a id="line.473"></a>
<span class="sourceLineNo">474</span><a id="line.474">                getManager( ReferenceManager.class ).initialize( pages );</a>
<span class="sourceLineNo">475</span><a id="line.475">            }</a>
<span class="sourceLineNo">476</span><a id="line.476"></a>
<span class="sourceLineNo">477</span><a id="line.477">        } catch( final ProviderException e ) {</a>
<span class="sourceLineNo">478</span><a id="line.478">            LOG.fatal( "PageProvider is unable to list pages: ", e );</a>
<span class="sourceLineNo">479</span><a id="line.479">        } catch( final Exception e ) {</a>
<span class="sourceLineNo">480</span><a id="line.480">            throw new WikiException( "Could not instantiate ReferenceManager: " + e.getMessage(), e );</a>
<span class="sourceLineNo">481</span><a id="line.481">        }</a>
<span class="sourceLineNo">482</span><a id="line.482">    }</a>
<span class="sourceLineNo">483</span><a id="line.483"></a>
<span class="sourceLineNo">484</span><a id="line.484">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">485</span><a id="line.485">    @Override</a>
<span class="sourceLineNo">486</span><a id="line.486">    public Properties getWikiProperties() {</a>
<span class="sourceLineNo">487</span><a id="line.487">        return m_properties;</a>
<span class="sourceLineNo">488</span><a id="line.488">    }</a>
<span class="sourceLineNo">489</span><a id="line.489"></a>
<span class="sourceLineNo">490</span><a id="line.490">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">491</span><a id="line.491">    @Override</a>
<span class="sourceLineNo">492</span><a id="line.492">    public String getWorkDir() {</a>
<span class="sourceLineNo">493</span><a id="line.493">        return m_workDir;</a>
<span class="sourceLineNo">494</span><a id="line.494">    }</a>
<span class="sourceLineNo">495</span><a id="line.495"></a>
<span class="sourceLineNo">496</span><a id="line.496">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">497</span><a id="line.497">    @Override</a>
<span class="sourceLineNo">498</span><a id="line.498">    public String getTemplateDir() {</a>
<span class="sourceLineNo">499</span><a id="line.499">        return m_templateDir;</a>
<span class="sourceLineNo">500</span><a id="line.500">    }</a>
<span class="sourceLineNo">501</span><a id="line.501"></a>
<span class="sourceLineNo">502</span><a id="line.502">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">503</span><a id="line.503">    @Override</a>
<span class="sourceLineNo">504</span><a id="line.504">    public Date getStartTime() {</a>
<span class="sourceLineNo">505</span><a id="line.505">        return ( Date )m_startTime.clone();</a>
<span class="sourceLineNo">506</span><a id="line.506">    }</a>
<span class="sourceLineNo">507</span><a id="line.507"></a>
<span class="sourceLineNo">508</span><a id="line.508">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">509</span><a id="line.509">    @Override</a>
<span class="sourceLineNo">510</span><a id="line.510">    public String getBaseURL() {</a>
<span class="sourceLineNo">511</span><a id="line.511">        return m_servletContext.getContextPath();</a>
<span class="sourceLineNo">512</span><a id="line.512">    }</a>
<span class="sourceLineNo">513</span><a id="line.513"></a>
<span class="sourceLineNo">514</span><a id="line.514">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">515</span><a id="line.515">    @Override</a>
<span class="sourceLineNo">516</span><a id="line.516">    public String getGlobalRSSURL() {</a>
<span class="sourceLineNo">517</span><a id="line.517">        final RSSGenerator rssGenerator = getManager( RSSGenerator.class );</a>
<span class="sourceLineNo">518</span><a id="line.518">        if( rssGenerator != null &amp;&amp; rssGenerator.isEnabled() ) {</a>
<span class="sourceLineNo">519</span><a id="line.519">            return getBaseURL() + "/" + rssGenerator.getRssFile();</a>
<span class="sourceLineNo">520</span><a id="line.520">        }</a>
<span class="sourceLineNo">521</span><a id="line.521"></a>
<span class="sourceLineNo">522</span><a id="line.522">        return null;</a>
<span class="sourceLineNo">523</span><a id="line.523">    }</a>
<span class="sourceLineNo">524</span><a id="line.524"></a>
<span class="sourceLineNo">525</span><a id="line.525">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">526</span><a id="line.526">    @Override</a>
<span class="sourceLineNo">527</span><a id="line.527">    public String getInterWikiURL( final String wikiName ) {</a>
<span class="sourceLineNo">528</span><a id="line.528">        return TextUtil.getStringProperty( m_properties,PROP_INTERWIKIREF + wikiName,null );</a>
<span class="sourceLineNo">529</span><a id="line.529">    }</a>
<span class="sourceLineNo">530</span><a id="line.530"></a>
<span class="sourceLineNo">531</span><a id="line.531">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">532</span><a id="line.532">    @Override</a>
<span class="sourceLineNo">533</span><a id="line.533">    public String getURL( final String context, String pageName, final String params ) {</a>
<span class="sourceLineNo">534</span><a id="line.534">        if( pageName == null ) {</a>
<span class="sourceLineNo">535</span><a id="line.535">            pageName = getFrontPage();</a>
<span class="sourceLineNo">536</span><a id="line.536">        }</a>
<span class="sourceLineNo">537</span><a id="line.537">        final URLConstructor urlConstructor = getManager( URLConstructor.class );</a>
<span class="sourceLineNo">538</span><a id="line.538">        return urlConstructor.makeURL( context, pageName, params );</a>
<span class="sourceLineNo">539</span><a id="line.539">    }</a>
<span class="sourceLineNo">540</span><a id="line.540"></a>
<span class="sourceLineNo">541</span><a id="line.541">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">542</span><a id="line.542">    @Override</a>
<span class="sourceLineNo">543</span><a id="line.543">    public String getFrontPage() {</a>
<span class="sourceLineNo">544</span><a id="line.544">        return m_frontPage;</a>
<span class="sourceLineNo">545</span><a id="line.545">    }</a>
<span class="sourceLineNo">546</span><a id="line.546"></a>
<span class="sourceLineNo">547</span><a id="line.547">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">548</span><a id="line.548">    @Override</a>
<span class="sourceLineNo">549</span><a id="line.549">    public ServletContext getServletContext() {</a>
<span class="sourceLineNo">550</span><a id="line.550">        return m_servletContext;</a>
<span class="sourceLineNo">551</span><a id="line.551">    }</a>
<span class="sourceLineNo">552</span><a id="line.552"></a>
<span class="sourceLineNo">553</span><a id="line.553">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">554</span><a id="line.554">    @Override</a>
<span class="sourceLineNo">555</span><a id="line.555">    public Collection&lt; String &gt; getAllInterWikiLinks() {</a>
<span class="sourceLineNo">556</span><a id="line.556">        final ArrayList&lt; String &gt; list = new ArrayList&lt;&gt;();</a>
<span class="sourceLineNo">557</span><a id="line.557">        for( final Enumeration&lt; ? &gt; i = m_properties.propertyNames(); i.hasMoreElements(); ) {</a>
<span class="sourceLineNo">558</span><a id="line.558">            final String prop = ( String )i.nextElement();</a>
<span class="sourceLineNo">559</span><a id="line.559">            if( prop.startsWith( PROP_INTERWIKIREF ) ) {</a>
<span class="sourceLineNo">560</span><a id="line.560">                list.add( prop.substring( prop.lastIndexOf( "." ) + 1 ) );</a>
<span class="sourceLineNo">561</span><a id="line.561">            }</a>
<span class="sourceLineNo">562</span><a id="line.562">        }</a>
<span class="sourceLineNo">563</span><a id="line.563"></a>
<span class="sourceLineNo">564</span><a id="line.564">        return list;</a>
<span class="sourceLineNo">565</span><a id="line.565">    }</a>
<span class="sourceLineNo">566</span><a id="line.566"></a>
<span class="sourceLineNo">567</span><a id="line.567">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">568</span><a id="line.568">    @Override</a>
<span class="sourceLineNo">569</span><a id="line.569">    public Collection&lt; String &gt; getAllInlinedImagePatterns() {</a>
<span class="sourceLineNo">570</span><a id="line.570">        final ArrayList&lt; String &gt; ptrnlist = new ArrayList&lt;&gt;();</a>
<span class="sourceLineNo">571</span><a id="line.571">        for( final Enumeration&lt; ? &gt; e = m_properties.propertyNames(); e.hasMoreElements(); ) {</a>
<span class="sourceLineNo">572</span><a id="line.572">            final String name = ( String )e.nextElement();</a>
<span class="sourceLineNo">573</span><a id="line.573">            if( name.startsWith( PROP_INLINEIMAGEPTRN ) ) {</a>
<span class="sourceLineNo">574</span><a id="line.574">                ptrnlist.add( TextUtil.getStringProperty( m_properties, name, null ) );</a>
<span class="sourceLineNo">575</span><a id="line.575">            }</a>
<span class="sourceLineNo">576</span><a id="line.576">        }</a>
<span class="sourceLineNo">577</span><a id="line.577"></a>
<span class="sourceLineNo">578</span><a id="line.578">        if( ptrnlist.isEmpty() ) {</a>
<span class="sourceLineNo">579</span><a id="line.579">            ptrnlist.add( DEFAULT_INLINEPATTERN );</a>
<span class="sourceLineNo">580</span><a id="line.580">        }</a>
<span class="sourceLineNo">581</span><a id="line.581"></a>
<span class="sourceLineNo">582</span><a id="line.582">        return ptrnlist;</a>
<span class="sourceLineNo">583</span><a id="line.583">    }</a>
<span class="sourceLineNo">584</span><a id="line.584"></a>
<span class="sourceLineNo">585</span><a id="line.585">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">586</span><a id="line.586">    @Override</a>
<span class="sourceLineNo">587</span><a id="line.587">    public String getSpecialPageReference( final String original ) {</a>
<span class="sourceLineNo">588</span><a id="line.588">        return getManager( CommandResolver.class ).getSpecialPageReference( original );</a>
<span class="sourceLineNo">589</span><a id="line.589">    }</a>
<span class="sourceLineNo">590</span><a id="line.590"></a>
<span class="sourceLineNo">591</span><a id="line.591">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">592</span><a id="line.592">    @Override</a>
<span class="sourceLineNo">593</span><a id="line.593">    public String getApplicationName() {</a>
<span class="sourceLineNo">594</span><a id="line.594">        final String appName = TextUtil.getStringProperty( m_properties, PROP_APPNAME, Release.APPNAME );</a>
<span class="sourceLineNo">595</span><a id="line.595">        return TextUtil.cleanString( appName, TextUtil.PUNCTUATION_CHARS_ALLOWED );</a>
<span class="sourceLineNo">596</span><a id="line.596">    }</a>
<span class="sourceLineNo">597</span><a id="line.597"></a>
<span class="sourceLineNo">598</span><a id="line.598">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">599</span><a id="line.599">    @Override</a>
<span class="sourceLineNo">600</span><a id="line.600">    public String getFinalPageName( final String page ) throws ProviderException {</a>
<span class="sourceLineNo">601</span><a id="line.601">        return getManager( CommandResolver.class ).getFinalPageName( page );</a>
<span class="sourceLineNo">602</span><a id="line.602">    }</a>
<span class="sourceLineNo">603</span><a id="line.603"></a>
<span class="sourceLineNo">604</span><a id="line.604">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">605</span><a id="line.605">    @Override</a>
<span class="sourceLineNo">606</span><a id="line.606">    public String encodeName( final String pagename ) {</a>
<span class="sourceLineNo">607</span><a id="line.607">        try {</a>
<span class="sourceLineNo">608</span><a id="line.608">            return URLEncoder.encode( pagename, m_useUTF8 ? StandardCharsets.UTF_8.name() : StandardCharsets.ISO_8859_1.name() );</a>
<span class="sourceLineNo">609</span><a id="line.609">        } catch( final UnsupportedEncodingException e ) {</a>
<span class="sourceLineNo">610</span><a id="line.610">            throw new InternalWikiException( "ISO-8859-1 not a supported encoding!?!  Your platform is borked." , e);</a>
<span class="sourceLineNo">611</span><a id="line.611">        }</a>
<span class="sourceLineNo">612</span><a id="line.612">    }</a>
<span class="sourceLineNo">613</span><a id="line.613"></a>
<span class="sourceLineNo">614</span><a id="line.614">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">615</span><a id="line.615">    @Override</a>
<span class="sourceLineNo">616</span><a id="line.616">    public String decodeName( final String pagerequest ) {</a>
<span class="sourceLineNo">617</span><a id="line.617">        try {</a>
<span class="sourceLineNo">618</span><a id="line.618">            return URLDecoder.decode( pagerequest, m_useUTF8 ? StandardCharsets.UTF_8.name() : StandardCharsets.ISO_8859_1.name() );</a>
<span class="sourceLineNo">619</span><a id="line.619">        } catch( final UnsupportedEncodingException e ) {</a>
<span class="sourceLineNo">620</span><a id="line.620">            throw new InternalWikiException("ISO-8859-1 not a supported encoding!?!  Your platform is borked.", e);</a>
<span class="sourceLineNo">621</span><a id="line.621">        }</a>
<span class="sourceLineNo">622</span><a id="line.622">    }</a>
<span class="sourceLineNo">623</span><a id="line.623"></a>
<span class="sourceLineNo">624</span><a id="line.624">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">625</span><a id="line.625">    @Override</a>
<span class="sourceLineNo">626</span><a id="line.626">    public Charset getContentEncoding() {</a>
<span class="sourceLineNo">627</span><a id="line.627">        if( m_useUTF8 ) {</a>
<span class="sourceLineNo">628</span><a id="line.628">            return StandardCharsets.UTF_8;</a>
<span class="sourceLineNo">629</span><a id="line.629">        }</a>
<span class="sourceLineNo">630</span><a id="line.630">        return StandardCharsets.ISO_8859_1;</a>
<span class="sourceLineNo">631</span><a id="line.631">    }</a>
<span class="sourceLineNo">632</span><a id="line.632"></a>
<span class="sourceLineNo">633</span><a id="line.633">    /**</a>
<span class="sourceLineNo">634</span><a id="line.634">     * {@inheritDoc}</a>
<span class="sourceLineNo">635</span><a id="line.635">     * &lt;p&gt;It is called by {@link WikiServlet#destroy()}. When this method is called, it fires a "shutdown" WikiEngineEvent to</a>
<span class="sourceLineNo">636</span><a id="line.636">     * all registered listeners.</a>
<span class="sourceLineNo">637</span><a id="line.637">     */</a>
<span class="sourceLineNo">638</span><a id="line.638">    @Override</a>
<span class="sourceLineNo">639</span><a id="line.639">    public void shutdown() {</a>
<span class="sourceLineNo">640</span><a id="line.640">        fireEvent( WikiEngineEvent.SHUTDOWN );</a>
<span class="sourceLineNo">641</span><a id="line.641">        getManager( CachingManager.class ).shutdown();</a>
<span class="sourceLineNo">642</span><a id="line.642">        getManager( FilterManager.class ).destroy();</a>
<span class="sourceLineNo">643</span><a id="line.643">        WikiEventManager.shutdown();</a>
<span class="sourceLineNo">644</span><a id="line.644">    }</a>
<span class="sourceLineNo">645</span><a id="line.645"></a>
<span class="sourceLineNo">646</span><a id="line.646">    /**</a>
<span class="sourceLineNo">647</span><a id="line.647">     *  Returns the current TemplateManager.</a>
<span class="sourceLineNo">648</span><a id="line.648">     *</a>
<span class="sourceLineNo">649</span><a id="line.649">     *  @return A TemplateManager instance.</a>
<span class="sourceLineNo">650</span><a id="line.650">     * @deprecated use {@code getManager( TemplateManager.class )} instead.</a>
<span class="sourceLineNo">651</span><a id="line.651">     */</a>
<span class="sourceLineNo">652</span><a id="line.652">    @Deprecated</a>
<span class="sourceLineNo">653</span><a id="line.653">    public TemplateManager getTemplateManager() {</a>
<span class="sourceLineNo">654</span><a id="line.654">        return getManager( TemplateManager.class );</a>
<span class="sourceLineNo">655</span><a id="line.655">    }</a>
<span class="sourceLineNo">656</span><a id="line.656"></a>
<span class="sourceLineNo">657</span><a id="line.657">    /**</a>
<span class="sourceLineNo">658</span><a id="line.658">     * Returns the {@link org.apache.wiki.workflow.WorkflowManager} associated with this WikiEngine. If the WikiEngine has not been</a>
<span class="sourceLineNo">659</span><a id="line.659">     * initialized, this method will return &lt;code&gt;null&lt;/code&gt;.</a>
<span class="sourceLineNo">660</span><a id="line.660">     *</a>
<span class="sourceLineNo">661</span><a id="line.661">     * @return the task queue</a>
<span class="sourceLineNo">662</span><a id="line.662">     * @deprecated use {@code getManager( WorkflowManager.class )} instead.</a>
<span class="sourceLineNo">663</span><a id="line.663">     */</a>
<span class="sourceLineNo">664</span><a id="line.664">    @Deprecated</a>
<span class="sourceLineNo">665</span><a id="line.665">    public WorkflowManager getWorkflowManager() {</a>
<span class="sourceLineNo">666</span><a id="line.666">        return getManager( WorkflowManager.class );</a>
<span class="sourceLineNo">667</span><a id="line.667">    }</a>
<span class="sourceLineNo">668</span><a id="line.668"></a>
<span class="sourceLineNo">669</span><a id="line.669">    /**</a>
<span class="sourceLineNo">670</span><a id="line.670">     * Returns this object's ReferenceManager.</a>
<span class="sourceLineNo">671</span><a id="line.671">     *</a>
<span class="sourceLineNo">672</span><a id="line.672">     * @return The current ReferenceManager instance.</a>
<span class="sourceLineNo">673</span><a id="line.673">     * @since 1.6.1</a>
<span class="sourceLineNo">674</span><a id="line.674">     * @deprecated use {@code getManager( ReferenceManager.class )} instead.</a>
<span class="sourceLineNo">675</span><a id="line.675">     */</a>
<span class="sourceLineNo">676</span><a id="line.676">    @Deprecated</a>
<span class="sourceLineNo">677</span><a id="line.677">    public ReferenceManager getReferenceManager() {</a>
<span class="sourceLineNo">678</span><a id="line.678">        return getManager( ReferenceManager.class );</a>
<span class="sourceLineNo">679</span><a id="line.679">    }</a>
<span class="sourceLineNo">680</span><a id="line.680"></a>
<span class="sourceLineNo">681</span><a id="line.681">    /**</a>
<span class="sourceLineNo">682</span><a id="line.682">     * Returns the current rendering manager for this wiki application.</a>
<span class="sourceLineNo">683</span><a id="line.683">     *</a>
<span class="sourceLineNo">684</span><a id="line.684">     * @since 2.3.27</a>
<span class="sourceLineNo">685</span><a id="line.685">     * @return A RenderingManager object.</a>
<span class="sourceLineNo">686</span><a id="line.686">     * @deprecated use {@code getManager( RenderingManager.class )} instead.</a>
<span class="sourceLineNo">687</span><a id="line.687">     */</a>
<span class="sourceLineNo">688</span><a id="line.688">    @Deprecated</a>
<span class="sourceLineNo">689</span><a id="line.689">    public RenderingManager getRenderingManager() {</a>
<span class="sourceLineNo">690</span><a id="line.690">        return getManager( RenderingManager.class );</a>
<span class="sourceLineNo">691</span><a id="line.691">    }</a>
<span class="sourceLineNo">692</span><a id="line.692"></a>
<span class="sourceLineNo">693</span><a id="line.693">    /**</a>
<span class="sourceLineNo">694</span><a id="line.694">     * Returns the current plugin manager.</a>
<span class="sourceLineNo">695</span><a id="line.695">     *</a>
<span class="sourceLineNo">696</span><a id="line.696">     * @since 1.6.1</a>
<span class="sourceLineNo">697</span><a id="line.697">     * @return The current PluginManager instance</a>
<span class="sourceLineNo">698</span><a id="line.698">     * @deprecated use {@code getManager( PluginManager.class )} instead.</a>
<span class="sourceLineNo">699</span><a id="line.699">     */</a>
<span class="sourceLineNo">700</span><a id="line.700">    @Deprecated</a>
<span class="sourceLineNo">701</span><a id="line.701">    public PluginManager getPluginManager() {</a>
<span class="sourceLineNo">702</span><a id="line.702">        return getManager( PluginManager.class );</a>
<span class="sourceLineNo">703</span><a id="line.703">    }</a>
<span class="sourceLineNo">704</span><a id="line.704"></a>
<span class="sourceLineNo">705</span><a id="line.705">    /**</a>
<span class="sourceLineNo">706</span><a id="line.706">     *  Returns the current variable manager.</a>
<span class="sourceLineNo">707</span><a id="line.707">     *</a>
<span class="sourceLineNo">708</span><a id="line.708">     *  @return The current VariableManager.</a>
<span class="sourceLineNo">709</span><a id="line.709">     * @deprecated use {@code getManager( VariableManager.class )} instead.</a>
<span class="sourceLineNo">710</span><a id="line.710">     */</a>
<span class="sourceLineNo">711</span><a id="line.711">    @Deprecated</a>
<span class="sourceLineNo">712</span><a id="line.712">    public VariableManager getVariableManager()  {</a>
<span class="sourceLineNo">713</span><a id="line.713">        return getManager( VariableManager.class );</a>
<span class="sourceLineNo">714</span><a id="line.714">    }</a>
<span class="sourceLineNo">715</span><a id="line.715"></a>
<span class="sourceLineNo">716</span><a id="line.716">    /**</a>
<span class="sourceLineNo">717</span><a id="line.717">     * Returns the current PageManager which is responsible for storing and managing WikiPages.</a>
<span class="sourceLineNo">718</span><a id="line.718">     *</a>
<span class="sourceLineNo">719</span><a id="line.719">     * @return The current PageManager instance.</a>
<span class="sourceLineNo">720</span><a id="line.720">     * @deprecated use {@code getManager( PageManager.class )} instead.</a>
<span class="sourceLineNo">721</span><a id="line.721">     */</a>
<span class="sourceLineNo">722</span><a id="line.722">    @Deprecated</a>
<span class="sourceLineNo">723</span><a id="line.723">    public PageManager getPageManager() {</a>
<span class="sourceLineNo">724</span><a id="line.724">        return getManager( PageManager.class );</a>
<span class="sourceLineNo">725</span><a id="line.725">    }</a>
<span class="sourceLineNo">726</span><a id="line.726"></a>
<span class="sourceLineNo">727</span><a id="line.727">    /**</a>
<span class="sourceLineNo">728</span><a id="line.728">     * Returns the CommandResolver for this wiki engine.</a>
<span class="sourceLineNo">729</span><a id="line.729">     *</a>
<span class="sourceLineNo">730</span><a id="line.730">     * @return the resolver</a>
<span class="sourceLineNo">731</span><a id="line.731">     * @deprecated use {@code getManager( CommandResolver.class )} instead.</a>
<span class="sourceLineNo">732</span><a id="line.732">     */</a>
<span class="sourceLineNo">733</span><a id="line.733">    @Deprecated</a>
<span class="sourceLineNo">734</span><a id="line.734">    public CommandResolver getCommandResolver() {</a>
<span class="sourceLineNo">735</span><a id="line.735">        return getManager( CommandResolver.class );</a>
<span class="sourceLineNo">736</span><a id="line.736">    }</a>
<span class="sourceLineNo">737</span><a id="line.737"></a>
<span class="sourceLineNo">738</span><a id="line.738">    /**</a>
<span class="sourceLineNo">739</span><a id="line.739">     * Returns the current AttachmentManager, which is responsible for storing and managing attachments.</a>
<span class="sourceLineNo">740</span><a id="line.740">     *</a>
<span class="sourceLineNo">741</span><a id="line.741">     * @since 1.9.31.</a>
<span class="sourceLineNo">742</span><a id="line.742">     * @return The current AttachmentManager instance</a>
<span class="sourceLineNo">743</span><a id="line.743">     * @deprecated use {@code getManager( AttachmentManager.class )} instead.</a>
<span class="sourceLineNo">744</span><a id="line.744">     */</a>
<span class="sourceLineNo">745</span><a id="line.745">    @Deprecated</a>
<span class="sourceLineNo">746</span><a id="line.746">    public AttachmentManager getAttachmentManager() {</a>
<span class="sourceLineNo">747</span><a id="line.747">        return getManager( AttachmentManager.class );</a>
<span class="sourceLineNo">748</span><a id="line.748">    }</a>
<span class="sourceLineNo">749</span><a id="line.749"></a>
<span class="sourceLineNo">750</span><a id="line.750">    /**</a>
<span class="sourceLineNo">751</span><a id="line.751">     * Returns the currently used authorization manager.</a>
<span class="sourceLineNo">752</span><a id="line.752">     *</a>
<span class="sourceLineNo">753</span><a id="line.753">     * @return The current AuthorizationManager instance.</a>
<span class="sourceLineNo">754</span><a id="line.754">     * @deprecated use {@code getManager( AuthorizationManager.class )} instead.</a>
<span class="sourceLineNo">755</span><a id="line.755">     */</a>
<span class="sourceLineNo">756</span><a id="line.756">    @Deprecated</a>
<span class="sourceLineNo">757</span><a id="line.757">    public AuthorizationManager getAuthorizationManager()  {</a>
<span class="sourceLineNo">758</span><a id="line.758">        return getManager( AuthorizationManager.class );</a>
<span class="sourceLineNo">759</span><a id="line.759">    }</a>
<span class="sourceLineNo">760</span><a id="line.760"></a>
<span class="sourceLineNo">761</span><a id="line.761">    /**</a>
<span class="sourceLineNo">762</span><a id="line.762">     * Returns the currently used authentication manager.</a>
<span class="sourceLineNo">763</span><a id="line.763">     *</a>
<span class="sourceLineNo">764</span><a id="line.764">     * @return The current AuthenticationManager instance.</a>
<span class="sourceLineNo">765</span><a id="line.765">     * @deprecated use {@code getManager( AuthenticationManager.class )} instead.</a>
<span class="sourceLineNo">766</span><a id="line.766">     */</a>
<span class="sourceLineNo">767</span><a id="line.767">    @Deprecated</a>
<span class="sourceLineNo">768</span><a id="line.768">    public AuthenticationManager getAuthenticationManager() {</a>
<span class="sourceLineNo">769</span><a id="line.769">        return getManager( AuthenticationManager.class );</a>
<span class="sourceLineNo">770</span><a id="line.770">    }</a>
<span class="sourceLineNo">771</span><a id="line.771"></a>
<span class="sourceLineNo">772</span><a id="line.772">    /**</a>
<span class="sourceLineNo">773</span><a id="line.773">     * Returns the manager responsible for the filters.</a>
<span class="sourceLineNo">774</span><a id="line.774">     *</a>
<span class="sourceLineNo">775</span><a id="line.775">     * @since 2.1.88</a>
<span class="sourceLineNo">776</span><a id="line.776">     * @return The current FilterManager instance.</a>
<span class="sourceLineNo">777</span><a id="line.777">     * @deprecated use {@code getManager( FilterManager.class )} instead.</a>
<span class="sourceLineNo">778</span><a id="line.778">     */</a>
<span class="sourceLineNo">779</span><a id="line.779">    @Deprecated</a>
<span class="sourceLineNo">780</span><a id="line.780">    public FilterManager getFilterManager() {</a>
<span class="sourceLineNo">781</span><a id="line.781">        return getManager( FilterManager.class );</a>
<span class="sourceLineNo">782</span><a id="line.782">    }</a>
<span class="sourceLineNo">783</span><a id="line.783"></a>
<span class="sourceLineNo">784</span><a id="line.784">    /**</a>
<span class="sourceLineNo">785</span><a id="line.785">     * Returns the manager responsible for searching the Wiki.</a>
<span class="sourceLineNo">786</span><a id="line.786">     *</a>
<span class="sourceLineNo">787</span><a id="line.787">     * @since 2.2.21</a>
<span class="sourceLineNo">788</span><a id="line.788">     * @return The current SearchManager instance.</a>
<span class="sourceLineNo">789</span><a id="line.789">     * @deprecated use {@code getManager( SearchManager.class )} instead.</a>
<span class="sourceLineNo">790</span><a id="line.790">     */</a>
<span class="sourceLineNo">791</span><a id="line.791">    @Deprecated</a>
<span class="sourceLineNo">792</span><a id="line.792">    public SearchManager getSearchManager() {</a>
<span class="sourceLineNo">793</span><a id="line.793">        return getManager( SearchManager.class );</a>
<span class="sourceLineNo">794</span><a id="line.794">    }</a>
<span class="sourceLineNo">795</span><a id="line.795"></a>
<span class="sourceLineNo">796</span><a id="line.796">    /**</a>
<span class="sourceLineNo">797</span><a id="line.797">     * Returns the progress manager we're using</a>
<span class="sourceLineNo">798</span><a id="line.798">     *</a>
<span class="sourceLineNo">799</span><a id="line.799">     * @return A ProgressManager.</a>
<span class="sourceLineNo">800</span><a id="line.800">     * @since 2.6</a>
<span class="sourceLineNo">801</span><a id="line.801">     * @deprecated use {@code getManager( ProgressManager.class )} instead.</a>
<span class="sourceLineNo">802</span><a id="line.802">     */</a>
<span class="sourceLineNo">803</span><a id="line.803">    @Deprecated</a>
<span class="sourceLineNo">804</span><a id="line.804">    public ProgressManager getProgressManager() {</a>
<span class="sourceLineNo">805</span><a id="line.805">        return getManager( ProgressManager.class );</a>
<span class="sourceLineNo">806</span><a id="line.806">    }</a>
<span class="sourceLineNo">807</span><a id="line.807"></a>
<span class="sourceLineNo">808</span><a id="line.808">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">809</span><a id="line.809">    @Override</a>
<span class="sourceLineNo">810</span><a id="line.810">    public String getRootPath() {</a>
<span class="sourceLineNo">811</span><a id="line.811">        return m_rootPath;</a>
<span class="sourceLineNo">812</span><a id="line.812">    }</a>
<span class="sourceLineNo">813</span><a id="line.813"></a>
<span class="sourceLineNo">814</span><a id="line.814">    /**</a>
<span class="sourceLineNo">815</span><a id="line.815">     * @since 2.2.6</a>
<span class="sourceLineNo">816</span><a id="line.816">     * @return the URL constructor.</a>
<span class="sourceLineNo">817</span><a id="line.817">     * @deprecated use {@code getManager( URLConstructor.class )} instead.</a>
<span class="sourceLineNo">818</span><a id="line.818">     */</a>
<span class="sourceLineNo">819</span><a id="line.819">    @Deprecated</a>
<span class="sourceLineNo">820</span><a id="line.820">    public URLConstructor getURLConstructor() {</a>
<span class="sourceLineNo">821</span><a id="line.821">        return getManager( URLConstructor.class );</a>
<span class="sourceLineNo">822</span><a id="line.822">    }</a>
<span class="sourceLineNo">823</span><a id="line.823"></a>
<span class="sourceLineNo">824</span><a id="line.824">    /**</a>
<span class="sourceLineNo">825</span><a id="line.825">     * Returns the RSSGenerator. If the property &lt;code&gt;jspwiki.rss.generate&lt;/code&gt; has not been set to &lt;code&gt;true&lt;/code&gt;, this method</a>
<span class="sourceLineNo">826</span><a id="line.826">     * will return &lt;code&gt;null&lt;/code&gt;, &lt;em&gt;and callers should check for this value.&lt;/em&gt;</a>
<span class="sourceLineNo">827</span><a id="line.827">     *</a>
<span class="sourceLineNo">828</span><a id="line.828">     * @since 2.1.165</a>
<span class="sourceLineNo">829</span><a id="line.829">     * @return the RSS generator</a>
<span class="sourceLineNo">830</span><a id="line.830">     * @deprecated use {@code getManager( RSSGenerator.class )} instead.</a>
<span class="sourceLineNo">831</span><a id="line.831">     */</a>
<span class="sourceLineNo">832</span><a id="line.832">    @Deprecated</a>
<span class="sourceLineNo">833</span><a id="line.833">    public RSSGenerator getRSSGenerator() {</a>
<span class="sourceLineNo">834</span><a id="line.834">        return getManager( RSSGenerator.class );</a>
<span class="sourceLineNo">835</span><a id="line.835">    }</a>
<span class="sourceLineNo">836</span><a id="line.836"></a>
<span class="sourceLineNo">837</span><a id="line.837">    /**</a>
<span class="sourceLineNo">838</span><a id="line.838">     *  Returns the PageRenamer employed by this WikiEngine.</a>
<span class="sourceLineNo">839</span><a id="line.839">     *</a>
<span class="sourceLineNo">840</span><a id="line.840">     *  @since 2.5.141</a>
<span class="sourceLineNo">841</span><a id="line.841">     *  @return The current PageRenamer instance.</a>
<span class="sourceLineNo">842</span><a id="line.842">     * @deprecated use {@code getManager( PageRenamer.class )} instead.</a>
<span class="sourceLineNo">843</span><a id="line.843">     */</a>
<span class="sourceLineNo">844</span><a id="line.844">    @Deprecated</a>
<span class="sourceLineNo">845</span><a id="line.845">    public PageRenamer getPageRenamer() {</a>
<span class="sourceLineNo">846</span><a id="line.846">        return getManager( PageRenamer.class );</a>
<span class="sourceLineNo">847</span><a id="line.847">    }</a>
<span class="sourceLineNo">848</span><a id="line.848"></a>
<span class="sourceLineNo">849</span><a id="line.849">    /**</a>
<span class="sourceLineNo">850</span><a id="line.850">     *  Returns the UserManager employed by this WikiEngine.</a>
<span class="sourceLineNo">851</span><a id="line.851">     *</a>
<span class="sourceLineNo">852</span><a id="line.852">     *  @since 2.3</a>
<span class="sourceLineNo">853</span><a id="line.853">     *  @return The current UserManager instance.</a>
<span class="sourceLineNo">854</span><a id="line.854">     * @deprecated use {@code getManager( UserManager.class )} instead.</a>
<span class="sourceLineNo">855</span><a id="line.855">     */</a>
<span class="sourceLineNo">856</span><a id="line.856">    @Deprecated</a>
<span class="sourceLineNo">857</span><a id="line.857">    public UserManager getUserManager() {</a>
<span class="sourceLineNo">858</span><a id="line.858">        return getManager( UserManager.class );</a>
<span class="sourceLineNo">859</span><a id="line.859">    }</a>
<span class="sourceLineNo">860</span><a id="line.860"></a>
<span class="sourceLineNo">861</span><a id="line.861">    /**</a>
<span class="sourceLineNo">862</span><a id="line.862">     *  Returns the TasksManager employed by this WikiEngine.</a>
<span class="sourceLineNo">863</span><a id="line.863">     *</a>
<span class="sourceLineNo">864</span><a id="line.864">     *  @return The current TasksManager instance.</a>
<span class="sourceLineNo">865</span><a id="line.865">     * @deprecated use {@code getManager( TaskManager.class )} instead.</a>
<span class="sourceLineNo">866</span><a id="line.866">     */</a>
<span class="sourceLineNo">867</span><a id="line.867">    @Deprecated</a>
<span class="sourceLineNo">868</span><a id="line.868">    public TasksManager getTasksManager() {</a>
<span class="sourceLineNo">869</span><a id="line.869">        return getManager( TasksManager.class );</a>
<span class="sourceLineNo">870</span><a id="line.870">    }</a>
<span class="sourceLineNo">871</span><a id="line.871"></a>
<span class="sourceLineNo">872</span><a id="line.872">    /**</a>
<span class="sourceLineNo">873</span><a id="line.873">     *  Returns the GroupManager employed by this WikiEngine.</a>
<span class="sourceLineNo">874</span><a id="line.874">     *</a>
<span class="sourceLineNo">875</span><a id="line.875">     *  @since 2.3</a>
<span class="sourceLineNo">876</span><a id="line.876">     *  @return The current GroupManager instance.</a>
<span class="sourceLineNo">877</span><a id="line.877">     * @deprecated use {@code getManager( GroupManager.class )} instead.</a>
<span class="sourceLineNo">878</span><a id="line.878">     */</a>
<span class="sourceLineNo">879</span><a id="line.879">    @Deprecated</a>
<span class="sourceLineNo">880</span><a id="line.880">    public GroupManager getGroupManager() {</a>
<span class="sourceLineNo">881</span><a id="line.881">        return getManager( GroupManager.class );</a>
<span class="sourceLineNo">882</span><a id="line.882">    }</a>
<span class="sourceLineNo">883</span><a id="line.883"></a>
<span class="sourceLineNo">884</span><a id="line.884">    /**</a>
<span class="sourceLineNo">885</span><a id="line.885">     *  Returns the current {@link AdminBeanManager}.</a>
<span class="sourceLineNo">886</span><a id="line.886">     *</a>
<span class="sourceLineNo">887</span><a id="line.887">     *  @return The current {@link AdminBeanManager}.</a>
<span class="sourceLineNo">888</span><a id="line.888">     *  @since  2.6</a>
<span class="sourceLineNo">889</span><a id="line.889">     * @deprecated use {@code getManager( AdminBeanManager.class )} instead.</a>
<span class="sourceLineNo">890</span><a id="line.890">     */</a>
<span class="sourceLineNo">891</span><a id="line.891">    @Deprecated</a>
<span class="sourceLineNo">892</span><a id="line.892">    public AdminBeanManager getAdminBeanManager() {</a>
<span class="sourceLineNo">893</span><a id="line.893">        return getManager( AdminBeanManager.class );</a>
<span class="sourceLineNo">894</span><a id="line.894">    }</a>
<span class="sourceLineNo">895</span><a id="line.895"></a>
<span class="sourceLineNo">896</span><a id="line.896">    /**</a>
<span class="sourceLineNo">897</span><a id="line.897">     *  Returns the AclManager employed by this WikiEngine. The AclManager is lazily initialized.</a>
<span class="sourceLineNo">898</span><a id="line.898">     *  &lt;p&gt;</a>
<span class="sourceLineNo">899</span><a id="line.899">     *  The AclManager implementing class may be set by the System property {@link #PROP_ACL_MANAGER_IMPL}.</a>
<span class="sourceLineNo">900</span><a id="line.900">     *  &lt;/p&gt;</a>
<span class="sourceLineNo">901</span><a id="line.901">     *</a>
<span class="sourceLineNo">902</span><a id="line.902">     * @since 2.3</a>
<span class="sourceLineNo">903</span><a id="line.903">     * @return The current AclManager.</a>
<span class="sourceLineNo">904</span><a id="line.904">     * @deprecated use {@code getManager( AclManager.class )} instead.</a>
<span class="sourceLineNo">905</span><a id="line.905">     */</a>
<span class="sourceLineNo">906</span><a id="line.906">    @Deprecated</a>
<span class="sourceLineNo">907</span><a id="line.907">    public AclManager getAclManager()  {</a>
<span class="sourceLineNo">908</span><a id="line.908">        return getManager( AclManager.class );</a>
<span class="sourceLineNo">909</span><a id="line.909">    }</a>
<span class="sourceLineNo">910</span><a id="line.910"></a>
<span class="sourceLineNo">911</span><a id="line.911">    /**</a>
<span class="sourceLineNo">912</span><a id="line.912">     *  Returns the DifferenceManager so that texts can be compared.</a>
<span class="sourceLineNo">913</span><a id="line.913">     *</a>
<span class="sourceLineNo">914</span><a id="line.914">     *  @return the difference manager.</a>
<span class="sourceLineNo">915</span><a id="line.915">     * @deprecated use {@code getManager( DifferenceManager.class )} instead.</a>
<span class="sourceLineNo">916</span><a id="line.916">     */</a>
<span class="sourceLineNo">917</span><a id="line.917">    @Deprecated</a>
<span class="sourceLineNo">918</span><a id="line.918">    public DifferenceManager getDifferenceManager() {</a>
<span class="sourceLineNo">919</span><a id="line.919">        return getManager( DifferenceManager.class );</a>
<span class="sourceLineNo">920</span><a id="line.920">    }</a>
<span class="sourceLineNo">921</span><a id="line.921"></a>
<span class="sourceLineNo">922</span><a id="line.922">    /**</a>
<span class="sourceLineNo">923</span><a id="line.923">     *  Returns the current EditorManager instance.</a>
<span class="sourceLineNo">924</span><a id="line.924">     *</a>
<span class="sourceLineNo">925</span><a id="line.925">     *  @return The current EditorManager.</a>
<span class="sourceLineNo">926</span><a id="line.926">     * @deprecated use {@code getManager( EditorManager.class )} instead.</a>
<span class="sourceLineNo">927</span><a id="line.927">     */</a>
<span class="sourceLineNo">928</span><a id="line.928">    @Deprecated</a>
<span class="sourceLineNo">929</span><a id="line.929">    public EditorManager getEditorManager() {</a>
<span class="sourceLineNo">930</span><a id="line.930">        return getManager( EditorManager.class );</a>
<span class="sourceLineNo">931</span><a id="line.931">    }</a>
<span class="sourceLineNo">932</span><a id="line.932"></a>
<span class="sourceLineNo">933</span><a id="line.933">    /**</a>
<span class="sourceLineNo">934</span><a id="line.934">     *  Returns the current i18n manager.</a>
<span class="sourceLineNo">935</span><a id="line.935">     *</a>
<span class="sourceLineNo">936</span><a id="line.936">     *  @return The current Intertan... Interante... Internatatializ... Whatever.</a>
<span class="sourceLineNo">937</span><a id="line.937">     * @deprecated use {@code getManager( InternationalizationManager.class )} instead.</a>
<span class="sourceLineNo">938</span><a id="line.938">     */</a>
<span class="sourceLineNo">939</span><a id="line.939">    @Deprecated</a>
<span class="sourceLineNo">940</span><a id="line.940">    public InternationalizationManager getInternationalizationManager() {</a>
<span class="sourceLineNo">941</span><a id="line.941">        return getManager( InternationalizationManager.class );</a>
<span class="sourceLineNo">942</span><a id="line.942">    }</a>
<span class="sourceLineNo">943</span><a id="line.943"></a>
<span class="sourceLineNo">944</span><a id="line.944">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">945</span><a id="line.945">    @Override</a>
<span class="sourceLineNo">946</span><a id="line.946">    public final synchronized void addWikiEventListener( final WikiEventListener listener ) {</a>
<span class="sourceLineNo">947</span><a id="line.947">        WikiEventManager.addWikiEventListener( this, listener );</a>
<span class="sourceLineNo">948</span><a id="line.948">    }</a>
<span class="sourceLineNo">949</span><a id="line.949"></a>
<span class="sourceLineNo">950</span><a id="line.950">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">951</span><a id="line.951">    @Override</a>
<span class="sourceLineNo">952</span><a id="line.952">    public final synchronized void removeWikiEventListener( final WikiEventListener listener ) {</a>
<span class="sourceLineNo">953</span><a id="line.953">        WikiEventManager.removeWikiEventListener( this, listener );</a>
<span class="sourceLineNo">954</span><a id="line.954">    }</a>
<span class="sourceLineNo">955</span><a id="line.955"></a>
<span class="sourceLineNo">956</span><a id="line.956">    /**</a>
<span class="sourceLineNo">957</span><a id="line.957">     * Fires a WikiEngineEvent to all registered listeners.</a>
<span class="sourceLineNo">958</span><a id="line.958">     *</a>
<span class="sourceLineNo">959</span><a id="line.959">     * @param type  the event type</a>
<span class="sourceLineNo">960</span><a id="line.960">     */</a>
<span class="sourceLineNo">961</span><a id="line.961">    protected final void fireEvent( final int type ) {</a>
<span class="sourceLineNo">962</span><a id="line.962">        if( WikiEventManager.isListening(this ) ) {</a>
<span class="sourceLineNo">963</span><a id="line.963">            WikiEventManager.fireEvent( this, new WikiEngineEvent(this, type ) );</a>
<span class="sourceLineNo">964</span><a id="line.964">        }</a>
<span class="sourceLineNo">965</span><a id="line.965">    }</a>
<span class="sourceLineNo">966</span><a id="line.966"></a>
<span class="sourceLineNo">967</span><a id="line.967">    /**</a>
<span class="sourceLineNo">968</span><a id="line.968">     * Fires a WikiPageEvent to all registered listeners.</a>
<span class="sourceLineNo">969</span><a id="line.969">     *</a>
<span class="sourceLineNo">970</span><a id="line.970">     * @param type  the event type</a>
<span class="sourceLineNo">971</span><a id="line.971">     */</a>
<span class="sourceLineNo">972</span><a id="line.972">    protected final void firePageEvent( final int type, final String pageName ) {</a>
<span class="sourceLineNo">973</span><a id="line.973">        if( WikiEventManager.isListening(this ) ) {</a>
<span class="sourceLineNo">974</span><a id="line.974">            WikiEventManager.fireEvent(this,new WikiPageEvent(this, type, pageName ) );</a>
<span class="sourceLineNo">975</span><a id="line.975">        }</a>
<span class="sourceLineNo">976</span><a id="line.976">    }</a>
<span class="sourceLineNo">977</span><a id="line.977"></a>
<span class="sourceLineNo">978</span><a id="line.978">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">979</span><a id="line.979">    @Override</a>
<span class="sourceLineNo">980</span><a id="line.980">    public void setAttribute( final String key, final Object value ) {</a>
<span class="sourceLineNo">981</span><a id="line.981">        m_attributes.put( key, value );</a>
<span class="sourceLineNo">982</span><a id="line.982">    }</a>
<span class="sourceLineNo">983</span><a id="line.983"></a>
<span class="sourceLineNo">984</span><a id="line.984">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">985</span><a id="line.985">    @Override</a>
<span class="sourceLineNo">986</span><a id="line.986">    @SuppressWarnings( "unchecked" )</a>
<span class="sourceLineNo">987</span><a id="line.987">    public &lt; T &gt; T getAttribute( final String key ) {</a>
<span class="sourceLineNo">988</span><a id="line.988">        return ( T )m_attributes.get( key );</a>
<span class="sourceLineNo">989</span><a id="line.989">    }</a>
<span class="sourceLineNo">990</span><a id="line.990"></a>
<span class="sourceLineNo">991</span><a id="line.991">    /** {@inheritDoc} */</a>
<span class="sourceLineNo">992</span><a id="line.992">    @Override</a>
<span class="sourceLineNo">993</span><a id="line.993">    @SuppressWarnings( "unchecked" )</a>
<span class="sourceLineNo">994</span><a id="line.994">    public &lt; T &gt; T removeAttribute( final String key ) {</a>
<span class="sourceLineNo">995</span><a id="line.995">        return ( T )m_attributes.remove( key );</a>
<span class="sourceLineNo">996</span><a id="line.996">    }</a>
<span class="sourceLineNo">997</span><a id="line.997"></a>
<span class="sourceLineNo">998</span><a id="line.998">}</a>




























































</pre>
</div>
</main>
</body>
</html>
