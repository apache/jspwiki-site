<!DOCTYPE HTML>
<html lang="es">
<head>
<!-- Generated by javadoc -->
<title>Source code</title>
<meta name="description" content="source: package: org.apache.wiki.plugin, class: ReferredPagesPlugin">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
</head>
<body class="source-page">
<main role="main">
<div class="source-container">
<pre><span class="source-line-no">001</span><span id="line.1">/*</span>
<span class="source-line-no">002</span><span id="line.2">    Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="source-line-no">003</span><span id="line.3">    or more contributor license agreements.  See the NOTICE file</span>
<span class="source-line-no">004</span><span id="line.4">    distributed with this work for additional information</span>
<span class="source-line-no">005</span><span id="line.5">    regarding copyright ownership.  The ASF licenses this file</span>
<span class="source-line-no">006</span><span id="line.6">    to you under the Apache License, Version 2.0 (the</span>
<span class="source-line-no">007</span><span id="line.7">    "License"); you may not use this file except in compliance</span>
<span class="source-line-no">008</span><span id="line.8">    with the License.  You may obtain a copy of the License at</span>
<span class="source-line-no">009</span><span id="line.9"></span>
<span class="source-line-no">010</span><span id="line.10">       http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="source-line-no">011</span><span id="line.11"></span>
<span class="source-line-no">012</span><span id="line.12">    Unless required by applicable law or agreed to in writing,</span>
<span class="source-line-no">013</span><span id="line.13">    software distributed under the License is distributed on an</span>
<span class="source-line-no">014</span><span id="line.14">    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="source-line-no">015</span><span id="line.15">    KIND, either express or implied.  See the License for the</span>
<span class="source-line-no">016</span><span id="line.16">    specific language governing permissions and limitations</span>
<span class="source-line-no">017</span><span id="line.17">    under the License.</span>
<span class="source-line-no">018</span><span id="line.18">*/</span>
<span class="source-line-no">019</span><span id="line.19">package org.apache.wiki.plugin;</span>
<span class="source-line-no">020</span><span id="line.20"></span>
<span class="source-line-no">021</span><span id="line.21">import org.apache.log4j.Logger;</span>
<span class="source-line-no">022</span><span id="line.22">import org.apache.oro.text.regex.MalformedPatternException;</span>
<span class="source-line-no">023</span><span id="line.23">import org.apache.oro.text.regex.Pattern;</span>
<span class="source-line-no">024</span><span id="line.24">import org.apache.oro.text.regex.PatternCompiler;</span>
<span class="source-line-no">025</span><span id="line.25">import org.apache.oro.text.regex.PatternMatcher;</span>
<span class="source-line-no">026</span><span id="line.26">import org.apache.oro.text.regex.Perl5Compiler;</span>
<span class="source-line-no">027</span><span id="line.27">import org.apache.oro.text.regex.Perl5Matcher;</span>
<span class="source-line-no">028</span><span id="line.28">import org.apache.wiki.api.core.Context;</span>
<span class="source-line-no">029</span><span id="line.29">import org.apache.wiki.api.core.ContextEnum;</span>
<span class="source-line-no">030</span><span id="line.30">import org.apache.wiki.api.core.Engine;</span>
<span class="source-line-no">031</span><span id="line.31">import org.apache.wiki.api.core.Page;</span>
<span class="source-line-no">032</span><span id="line.32">import org.apache.wiki.api.exceptions.PluginException;</span>
<span class="source-line-no">033</span><span id="line.33">import org.apache.wiki.api.plugin.Plugin;</span>
<span class="source-line-no">034</span><span id="line.34">import org.apache.wiki.pages.PageManager;</span>
<span class="source-line-no">035</span><span id="line.35">import org.apache.wiki.references.ReferenceManager;</span>
<span class="source-line-no">036</span><span id="line.36">import org.apache.wiki.util.TextUtil;</span>
<span class="source-line-no">037</span><span id="line.37"></span>
<span class="source-line-no">038</span><span id="line.38">import java.util.ArrayList;</span>
<span class="source-line-no">039</span><span id="line.39">import java.util.Collection;</span>
<span class="source-line-no">040</span><span id="line.40">import java.util.HashSet;</span>
<span class="source-line-no">041</span><span id="line.41">import java.util.Map;</span>
<span class="source-line-no">042</span><span id="line.42"></span>
<span class="source-line-no">043</span><span id="line.43"></span>
<span class="source-line-no">044</span><span id="line.44">/**</span>
<span class="source-line-no">045</span><span id="line.45"> *  Displays the pages referring to the current page.</span>
<span class="source-line-no">046</span><span id="line.46"> *</span>
<span class="source-line-no">047</span><span id="line.47"> *  &lt;p&gt;Parameters&lt;/p&gt;</span>
<span class="source-line-no">048</span><span id="line.48"> *  &lt;ul&gt;</span>
<span class="source-line-no">049</span><span id="line.49"> *    &lt;li&gt;&lt;b&gt;name&lt;/b&gt; - Name of the root page. Default name of calling page</span>
<span class="source-line-no">050</span><span id="line.50"> *    &lt;li&gt;&lt;b&gt;type&lt;/b&gt; - local|externalattachment</span>
<span class="source-line-no">051</span><span id="line.51"> *    &lt;li&gt;&lt;b&gt;depth&lt;/b&gt; - How many levels of pages to be parsed.</span>
<span class="source-line-no">052</span><span id="line.52"> *    &lt;li&gt;&lt;b&gt;include&lt;/b&gt; - Include only these pages. (eg. include='UC.*|BP.*' )</span>
<span class="source-line-no">053</span><span id="line.53"> *    &lt;li&gt;&lt;b&gt;exclude&lt;/b&gt; - Exclude with this pattern. (eg. exclude='LeftMenu' )</span>
<span class="source-line-no">054</span><span id="line.54"> *    &lt;li&gt;&lt;b&gt;format&lt;/b&gt; -  full|compact, FULL now expands all levels correctly</span>
<span class="source-line-no">055</span><span id="line.55"> *  &lt;/ul&gt;</span>
<span class="source-line-no">056</span><span id="line.56"> *</span>
<span class="source-line-no">057</span><span id="line.57"> */</span>
<span class="source-line-no">058</span><span id="line.58">public class ReferredPagesPlugin implements Plugin {</span>
<span class="source-line-no">059</span><span id="line.59"></span>
<span class="source-line-no">060</span><span id="line.60">    private static final Logger log = Logger.getLogger( ReferredPagesPlugin.class );</span>
<span class="source-line-no">061</span><span id="line.61">    private Engine         m_engine;</span>
<span class="source-line-no">062</span><span id="line.62">    private int            m_depth;</span>
<span class="source-line-no">063</span><span id="line.63">    private HashSet&lt;String&gt; m_exists  = new HashSet&lt;&gt;();</span>
<span class="source-line-no">064</span><span id="line.64">    private StringBuffer   m_result  = new StringBuffer(1024);</span>
<span class="source-line-no">065</span><span id="line.65">    private PatternMatcher m_matcher = new Perl5Matcher();</span>
<span class="source-line-no">066</span><span id="line.66">    private Pattern        m_includePattern;</span>
<span class="source-line-no">067</span><span id="line.67">    private Pattern        m_excludePattern;</span>
<span class="source-line-no">068</span><span id="line.68">    private boolean m_formatCompact  = true;</span>
<span class="source-line-no">069</span><span id="line.69">    private boolean m_formatSort     = false;</span>
<span class="source-line-no">070</span><span id="line.70"></span>
<span class="source-line-no">071</span><span id="line.71">    /** The parameter name for the root page to start from.  Value is &lt;tt&gt;{@value}&lt;/tt&gt;. */</span>
<span class="source-line-no">072</span><span id="line.72">    public static final String PARAM_ROOT    = "page";</span>
<span class="source-line-no">073</span><span id="line.73"></span>
<span class="source-line-no">074</span><span id="line.74">    /** The parameter name for the depth.  Value is &lt;tt&gt;{@value}&lt;/tt&gt;. */</span>
<span class="source-line-no">075</span><span id="line.75">    public static final String PARAM_DEPTH   = "depth";</span>
<span class="source-line-no">076</span><span id="line.76"></span>
<span class="source-line-no">077</span><span id="line.77">    /** The parameter name for the type of the references.  Value is &lt;tt&gt;{@value}&lt;/tt&gt;. */</span>
<span class="source-line-no">078</span><span id="line.78">    public static final String PARAM_TYPE    = "type";</span>
<span class="source-line-no">079</span><span id="line.79"></span>
<span class="source-line-no">080</span><span id="line.80">    /** The parameter name for the included pages.  Value is &lt;tt&gt;{@value}&lt;/tt&gt;. */</span>
<span class="source-line-no">081</span><span id="line.81">    public static final String PARAM_INCLUDE = "include";</span>
<span class="source-line-no">082</span><span id="line.82"></span>
<span class="source-line-no">083</span><span id="line.83">    /** The parameter name for the excluded pages.  Value is &lt;tt&gt;{@value}&lt;/tt&gt;. */</span>
<span class="source-line-no">084</span><span id="line.84">    public static final String PARAM_EXCLUDE = "exclude";</span>
<span class="source-line-no">085</span><span id="line.85"></span>
<span class="source-line-no">086</span><span id="line.86">    /** The parameter name for the format.  Value is &lt;tt&gt;{@value}&lt;/tt&gt;. */</span>
<span class="source-line-no">087</span><span id="line.87">    public static final String PARAM_FORMAT  = "format";</span>
<span class="source-line-no">088</span><span id="line.88"></span>
<span class="source-line-no">089</span><span id="line.89">    /** The minimum depth. Value is &lt;tt&gt;{@value}&lt;/tt&gt;. */</span>
<span class="source-line-no">090</span><span id="line.90">    public static final int    MIN_DEPTH = 1;</span>
<span class="source-line-no">091</span><span id="line.91"></span>
<span class="source-line-no">092</span><span id="line.92">    /** The maximum depth. Value is &lt;tt&gt;{@value}&lt;/tt&gt;. */</span>
<span class="source-line-no">093</span><span id="line.93">    public static final int    MAX_DEPTH = 8;</span>
<span class="source-line-no">094</span><span id="line.94"></span>
<span class="source-line-no">095</span><span id="line.95">    /**</span>
<span class="source-line-no">096</span><span id="line.96">     *  {@inheritDoc}</span>
<span class="source-line-no">097</span><span id="line.97">     */</span>
<span class="source-line-no">098</span><span id="line.98">    @Override</span>
<span class="source-line-no">099</span><span id="line.99">    public String execute( final Context context, final Map&lt;String, String&gt; params ) throws PluginException {</span>
<span class="source-line-no">100</span><span id="line.100">        m_engine = context.getEngine();</span>
<span class="source-line-no">101</span><span id="line.101">        final Page page = context.getPage();</span>
<span class="source-line-no">102</span><span id="line.102">        if( page == null ) {</span>
<span class="source-line-no">103</span><span id="line.103">            return "";</span>
<span class="source-line-no">104</span><span id="line.104">        }</span>
<span class="source-line-no">105</span><span id="line.105"></span>
<span class="source-line-no">106</span><span id="line.106">        // parse parameters</span>
<span class="source-line-no">107</span><span id="line.107">        String rootname = params.get( PARAM_ROOT );</span>
<span class="source-line-no">108</span><span id="line.108">        if( rootname == null ) {</span>
<span class="source-line-no">109</span><span id="line.109">            rootname = page.getName() ;</span>
<span class="source-line-no">110</span><span id="line.110">        }</span>
<span class="source-line-no">111</span><span id="line.111"></span>
<span class="source-line-no">112</span><span id="line.112">        String format = params.get( PARAM_FORMAT );</span>
<span class="source-line-no">113</span><span id="line.113">        if( format == null) {</span>
<span class="source-line-no">114</span><span id="line.114">            format = "";</span>
<span class="source-line-no">115</span><span id="line.115">        }</span>
<span class="source-line-no">116</span><span id="line.116">        if( format.contains( "full" ) ) {</span>
<span class="source-line-no">117</span><span id="line.117">            m_formatCompact = false ;</span>
<span class="source-line-no">118</span><span id="line.118">        }</span>
<span class="source-line-no">119</span><span id="line.119">        if( format.contains( "sort" ) ) {</span>
<span class="source-line-no">120</span><span id="line.120">            m_formatSort = true  ;</span>
<span class="source-line-no">121</span><span id="line.121">        }</span>
<span class="source-line-no">122</span><span id="line.122"></span>
<span class="source-line-no">123</span><span id="line.123">        m_depth = TextUtil.parseIntParameter( params.get( PARAM_DEPTH ), MIN_DEPTH );</span>
<span class="source-line-no">124</span><span id="line.124">        if( m_depth &gt; MAX_DEPTH )  m_depth = MAX_DEPTH;</span>
<span class="source-line-no">125</span><span id="line.125"></span>
<span class="source-line-no">126</span><span id="line.126">        String includePattern = params.get(PARAM_INCLUDE);</span>
<span class="source-line-no">127</span><span id="line.127">        if( includePattern == null ) includePattern = ".*";</span>
<span class="source-line-no">128</span><span id="line.128"></span>
<span class="source-line-no">129</span><span id="line.129">        String excludePattern = params.get(PARAM_EXCLUDE);</span>
<span class="source-line-no">130</span><span id="line.130">        if( excludePattern == null ) excludePattern = "^$";</span>
<span class="source-line-no">131</span><span id="line.131"></span>
<span class="source-line-no">132</span><span id="line.132">        log.debug( "Fetching referred pages for "+ rootname +</span>
<span class="source-line-no">133</span><span id="line.133">                   " with a depth of "+ m_depth +</span>
<span class="source-line-no">134</span><span id="line.134">                   " with include pattern of "+ includePattern +</span>
<span class="source-line-no">135</span><span id="line.135">                   " with exclude pattern of "+ excludePattern );</span>
<span class="source-line-no">136</span><span id="line.136"></span>
<span class="source-line-no">137</span><span id="line.137">        //</span>
<span class="source-line-no">138</span><span id="line.138">        // do the actual work</span>
<span class="source-line-no">139</span><span id="line.139">        //</span>
<span class="source-line-no">140</span><span id="line.140">        final String href  = context.getViewURL( rootname );</span>
<span class="source-line-no">141</span><span id="line.141">        final String title = "ReferredPagesPlugin: depth[" + m_depth +</span>
<span class="source-line-no">142</span><span id="line.142">                             "] include[" + includePattern + "] exclude[" + excludePattern +</span>
<span class="source-line-no">143</span><span id="line.143">                             "] format[" + ( m_formatCompact ? "compact" : "full" ) +</span>
<span class="source-line-no">144</span><span id="line.144">                             ( m_formatSort ? " sort" : "" ) + "]";</span>
<span class="source-line-no">145</span><span id="line.145"></span>
<span class="source-line-no">146</span><span id="line.146">        m_result.append( "&lt;div class=\"ReferredPagesPlugin\"&gt;\n" );</span>
<span class="source-line-no">147</span><span id="line.147">        m_result.append( "&lt;a class=\"wikipage\" href=\""+ href +</span>
<span class="source-line-no">148</span><span id="line.148">                         "\" title=\"" + TextUtil.replaceEntities( title ) +</span>
<span class="source-line-no">149</span><span id="line.149">                         "\"&gt;" + TextUtil.replaceEntities( rootname ) + "&lt;/a&gt;\n" );</span>
<span class="source-line-no">150</span><span id="line.150">        m_exists.add( rootname );</span>
<span class="source-line-no">151</span><span id="line.151"></span>
<span class="source-line-no">152</span><span id="line.152">        // pre compile all needed patterns</span>
<span class="source-line-no">153</span><span id="line.153">        // glob compiler :  * is 0..n instance of any char  -- more convenient as input</span>
<span class="source-line-no">154</span><span id="line.154">        // perl5 compiler : .* is 0..n instances of any char -- more powerful</span>
<span class="source-line-no">155</span><span id="line.155">        //PatternCompiler g_compiler = new GlobCompiler();</span>
<span class="source-line-no">156</span><span id="line.156">        final PatternCompiler compiler = new Perl5Compiler();</span>
<span class="source-line-no">157</span><span id="line.157"></span>
<span class="source-line-no">158</span><span id="line.158">        try {</span>
<span class="source-line-no">159</span><span id="line.159">            m_includePattern = compiler.compile( includePattern );</span>
<span class="source-line-no">160</span><span id="line.160">            m_excludePattern = compiler.compile( excludePattern );</span>
<span class="source-line-no">161</span><span id="line.161">        } catch( final MalformedPatternException e ) {</span>
<span class="source-line-no">162</span><span id="line.162">            if( m_includePattern == null ) {</span>
<span class="source-line-no">163</span><span id="line.163">                throw new PluginException( "Illegal include pattern detected." );</span>
<span class="source-line-no">164</span><span id="line.164">            } else if( m_excludePattern == null ) {</span>
<span class="source-line-no">165</span><span id="line.165">                throw new PluginException( "Illegal exclude pattern detected." );</span>
<span class="source-line-no">166</span><span id="line.166">            } else {</span>
<span class="source-line-no">167</span><span id="line.167">                throw new PluginException( "Illegal internal pattern detected." );</span>
<span class="source-line-no">168</span><span id="line.168">            }</span>
<span class="source-line-no">169</span><span id="line.169">        }</span>
<span class="source-line-no">170</span><span id="line.170"></span>
<span class="source-line-no">171</span><span id="line.171">        // go get all referred links</span>
<span class="source-line-no">172</span><span id="line.172">        getReferredPages(context,rootname, 0);</span>
<span class="source-line-no">173</span><span id="line.173"></span>
<span class="source-line-no">174</span><span id="line.174">        // close and finish</span>
<span class="source-line-no">175</span><span id="line.175">        m_result.append ("&lt;/div&gt;\n" ) ;</span>
<span class="source-line-no">176</span><span id="line.176"></span>
<span class="source-line-no">177</span><span id="line.177">        return m_result.toString() ;</span>
<span class="source-line-no">178</span><span id="line.178">    }</span>
<span class="source-line-no">179</span><span id="line.179"></span>
<span class="source-line-no">180</span><span id="line.180"></span>
<span class="source-line-no">181</span><span id="line.181">    /**</span>
<span class="source-line-no">182</span><span id="line.182">     * Retrieves a list of all referred pages. Is called recursively depending on the depth parameter.</span>
<span class="source-line-no">183</span><span id="line.183">     */</span>
<span class="source-line-no">184</span><span id="line.184">    private void getReferredPages( final Context context, final String pagename, int depth ) {</span>
<span class="source-line-no">185</span><span id="line.185">        if( depth &gt;= m_depth ) {</span>
<span class="source-line-no">186</span><span id="line.186">            return;  // end of recursion</span>
<span class="source-line-no">187</span><span id="line.187">        }</span>
<span class="source-line-no">188</span><span id="line.188">        if( pagename == null ) {</span>
<span class="source-line-no">189</span><span id="line.189">            return;</span>
<span class="source-line-no">190</span><span id="line.190">        }</span>
<span class="source-line-no">191</span><span id="line.191">        if( !m_engine.getManager( PageManager.class ).wikiPageExists(pagename) ) {</span>
<span class="source-line-no">192</span><span id="line.192">            return;</span>
<span class="source-line-no">193</span><span id="line.193">        }</span>
<span class="source-line-no">194</span><span id="line.194"></span>
<span class="source-line-no">195</span><span id="line.195">        final ReferenceManager mgr = m_engine.getManager( ReferenceManager.class );</span>
<span class="source-line-no">196</span><span id="line.196">        final Collection&lt; String &gt; allPages = mgr.findRefersTo( pagename );</span>
<span class="source-line-no">197</span><span id="line.197">        handleLinks( context, allPages, ++depth, pagename );</span>
<span class="source-line-no">198</span><span id="line.198">    }</span>
<span class="source-line-no">199</span><span id="line.199"></span>
<span class="source-line-no">200</span><span id="line.200">    private void handleLinks( final Context context, final Collection&lt;String&gt; links, final int depth, final String pagename) {</span>
<span class="source-line-no">201</span><span id="line.201">        boolean isUL = false;</span>
<span class="source-line-no">202</span><span id="line.202">        final HashSet&lt; String &gt; localLinkSet = new HashSet&lt;&gt;();  // needed to skip multiple</span>
<span class="source-line-no">203</span><span id="line.203">        // links to the same page</span>
<span class="source-line-no">204</span><span id="line.204">        localLinkSet.add( pagename );</span>
<span class="source-line-no">205</span><span id="line.205"></span>
<span class="source-line-no">206</span><span id="line.206">        final ArrayList&lt; String &gt; allLinks = new ArrayList&lt;&gt;();</span>
<span class="source-line-no">207</span><span id="line.207"></span>
<span class="source-line-no">208</span><span id="line.208">        if( links != null )</span>
<span class="source-line-no">209</span><span id="line.209">            allLinks.addAll( links );</span>
<span class="source-line-no">210</span><span id="line.210"></span>
<span class="source-line-no">211</span><span id="line.211">        if( m_formatSort ) context.getEngine().getManager( PageManager.class ).getPageSorter().sort( allLinks );</span>
<span class="source-line-no">212</span><span id="line.212"></span>
<span class="source-line-no">213</span><span id="line.213">        for( final String link : allLinks ) {</span>
<span class="source-line-no">214</span><span id="line.214">            if( localLinkSet.contains( link ) ) {</span>
<span class="source-line-no">215</span><span id="line.215">                continue; // skip multiple links to the same page</span>
<span class="source-line-no">216</span><span id="line.216">            }</span>
<span class="source-line-no">217</span><span id="line.217">            localLinkSet.add( link );</span>
<span class="source-line-no">218</span><span id="line.218"></span>
<span class="source-line-no">219</span><span id="line.219">            if( !m_engine.getManager( PageManager.class ).wikiPageExists( link ) ) {</span>
<span class="source-line-no">220</span><span id="line.220">                continue; // hide links to non existing pages</span>
<span class="source-line-no">221</span><span id="line.221">            }</span>
<span class="source-line-no">222</span><span id="line.222">            if(  m_matcher.matches( link , m_excludePattern ) ) {</span>
<span class="source-line-no">223</span><span id="line.223">                continue;</span>
<span class="source-line-no">224</span><span id="line.224">            }</span>
<span class="source-line-no">225</span><span id="line.225">            if( !m_matcher.matches( link , m_includePattern ) ) {</span>
<span class="source-line-no">226</span><span id="line.226">                continue;</span>
<span class="source-line-no">227</span><span id="line.227">            }</span>
<span class="source-line-no">228</span><span id="line.228"></span>
<span class="source-line-no">229</span><span id="line.229">            if( m_exists.contains( link ) ) {</span>
<span class="source-line-no">230</span><span id="line.230">                if( !m_formatCompact ) {</span>
<span class="source-line-no">231</span><span id="line.231">                    if( !isUL ) {</span>
<span class="source-line-no">232</span><span id="line.232">                        isUL = true;</span>
<span class="source-line-no">233</span><span id="line.233">                        m_result.append("&lt;ul&gt;\n");</span>
<span class="source-line-no">234</span><span id="line.234">                    }</span>
<span class="source-line-no">235</span><span id="line.235"></span>
<span class="source-line-no">236</span><span id="line.236">                    //See https://www.w3.org/wiki/HTML_lists  for proper nesting of UL and LI</span>
<span class="source-line-no">237</span><span id="line.237">                    m_result.append( "&lt;li&gt; " + TextUtil.replaceEntities(link) + "\n" );</span>
<span class="source-line-no">238</span><span id="line.238">                    getReferredPages( context, link, depth );  // added recursive call - on general request</span>
<span class="source-line-no">239</span><span id="line.239">                    m_result.append( "\n&lt;/li&gt;\n" );</span>
<span class="source-line-no">240</span><span id="line.240">                }</span>
<span class="source-line-no">241</span><span id="line.241">            } else {</span>
<span class="source-line-no">242</span><span id="line.242">                if( !isUL ) {</span>
<span class="source-line-no">243</span><span id="line.243">                    isUL = true;</span>
<span class="source-line-no">244</span><span id="line.244">                    m_result.append("&lt;ul&gt;\n");</span>
<span class="source-line-no">245</span><span id="line.245">                }</span>
<span class="source-line-no">246</span><span id="line.246"></span>
<span class="source-line-no">247</span><span id="line.247">                final String href = context.getURL( ContextEnum.PAGE_VIEW.getRequestContext(), link );</span>
<span class="source-line-no">248</span><span id="line.248">                m_result.append( "&lt;li&gt;&lt;a class=\"wikipage\" href=\"" + href + "\"&gt;" + TextUtil.replaceEntities(link) + "&lt;/a&gt;\n" );</span>
<span class="source-line-no">249</span><span id="line.249">                m_exists.add( link );</span>
<span class="source-line-no">250</span><span id="line.250">                getReferredPages( context, link, depth );</span>
<span class="source-line-no">251</span><span id="line.251">                m_result.append( "\n&lt;/li&gt;\n" );</span>
<span class="source-line-no">252</span><span id="line.252">            }</span>
<span class="source-line-no">253</span><span id="line.253">        }</span>
<span class="source-line-no">254</span><span id="line.254"></span>
<span class="source-line-no">255</span><span id="line.255">        if( isUL ) {</span>
<span class="source-line-no">256</span><span id="line.256">            m_result.append("&lt;/ul&gt;\n");</span>
<span class="source-line-no">257</span><span id="line.257">        }</span>
<span class="source-line-no">258</span><span id="line.258">    }</span>
<span class="source-line-no">259</span><span id="line.259"></span>
<span class="source-line-no">260</span><span id="line.260">}</span>




























































</pre>
</div>
</main>
</body>
</html>
